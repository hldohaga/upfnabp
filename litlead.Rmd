---
title: "Exposure to High Ultra-processed Food and Sodium Intake and its effect on Hypertension using the cross sectional study UK National Dietary and Nutritional Survey (NDNS) in England 2008-2019"
output:
  html_notebook: 
    toc: yes
    fig_caption: yes
    number_sections: yes
    code_folding: hide
  word_document: 
    toc: yes
    fig_caption: yes
    keep_md: yes
    toc_depth: 4
    fig_width: 4
    fig_height: 4
  pdf_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
    keep_tex: yes
    latex_engine: xelatex
    fig_width: 4
    fig_height: 4
  html_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
    keep_md: yes
    fig_width: 4
    fig_height: 4
editor_options: 
  markdown: 
    wrap: sentence
    bibliography: upfnabp.bib 
bibliography: references.bib
csl: Vancouver.csl
---

# Exposure to High Ultra-processed Food and Sodium Intake and its effect on Hypertension using the cross sectional study UK National Dietary and Nutritional Survey (NDNS) in England 2008-2019 {.unnumbered}

# David O'Hagan {.unnumbered}

200299857

## Dissertation submitted in partial fulfilment of the requirements for the degree of Master of Public Health, The University of Liverpool {.unnumbered}

## August 2023 {.unnumbered}

\newpage

## Dedication {.unnumbered}

To Julie Andrew and Sophie

for your loving patience and support

\newpage

## Acknowledgments {.unnumbered}

Thanks to Zoe and Martin

Thanks to Paul for the project which didn't quite come together

\newpage

\newpage

# Abstract {.unnumbered}

This is a secondary data study of the cross sectional study national dietary and nutrition survey @universityofcambridge2022.
This study looked at the outcome of hypertension compared with exposure to high intake of UPF and Na.

method

regression analysis

results

increased odds hypertension with higher sodium intake

lower odds hypertension with high upf intake

This study shows that high Na intake is associated with hypertension.
Reduction of sodium intake may be effective at reducing the overall risk.
UPF intake is also associated with hypertension.

discussion

confirms sodium and hyp

upf and bp ?
due to age separation, high upf in young, high bp in old

high upf not necessarily linked to high na!

Policy should aim to reduce intake of Na.
The accompanying literature review discusses aspects of policy and their effectiveness.

```{r library, include=FALSE}
library(haven)
library(data.table)
library(readxl)
#library(sensemakr)
library(labelled)
library(survey)
library(srvyr)
library(gtsummary)
library(stargazer)
library(knitr)
library(flextable)
library(officer)
library(dagitty)
library(grateful)
library(dplyr)
library(DiagrammeR)
```

```{=tex}
\tableofcontents
\listoffigures
\listoftables
\newpage
```
```{r tblabbreviations, echo=FALSE, message=TRUE, warning=TRUE}
#| tab-id: "table 1"
#| caption: "Table of abbreviations used"

table1 <- data.table("Abbreviation "=c("NDNS","BP","Na","UPF","NCD","CVD","CHAMPs","NOVA","NAFLD","BMI","mmHg","AIC"),"Term"=c("National Dietary and Nutrition Survey","Blood Pressure","Sodium intake in mg", "Ultra Processed Foods", "Non communicable Disease","Cardiovascular Disease","Cheshire and Merseyside public health  collaborative","NOVA is a classification system, it is not an acronym","non- alcohol fatty liver disease","Body Mass Index","Units of pressure used physiologically","AIC"))
table1 <- width(autofit(flextable(table1)), width=5)
table1 <- set_caption(table1, "Table of Abbreviations used", 
  autonum = run_autonum(seq_id = "tab", bkm = "table1"))
table1
```

\newpage

# Introduction

417482 people, 15.4% of the population, have hypertension in Cheshire and Merseyside @cardiova.
Cheshire and Merseyside public health collaborative (CHAMPs) have a plan to reduce BP by 2029 @highblo2020 .
The strategy aims to increase 'awareness'.
This is intended to increase individual compliance with testing and treatment of raised BP.
This study intends to offer additional opportunities for improving outcomes.

UPF makes up up to 60% diet in UK especially in the North West of England.
There is evidence of an association between hypertension and intake of Ultra-processed Foods (UPF) @du2014 and hypertension and Salt intake @cappuccio2015 from studies of different types in multiple countries.
Monteiro et al @moreira2015 model a scenarion where "halving intake of (NOVA) group 3 foods could result in approximately 22,055 fewer deaths" across the UK in 2030.
Local food policies around UPF might be a way of reducing hypertension at a population level.
There is potential for significant public health impact.

Marmot @marmot2022 identifies the external influences in Cheshire and Merseyside which need to be improved to permit individual action to be effective.
Using a better understanding of the role of UPF, and the interaction with sodium, might give a mechanism of action of some of Marmot's categories of influence.

This study assessed prevalence of exposure to sodium and UPF, and hypertension in the data set of the National Dietary and Nutrition Survey (NDNS) @universityofcambridge2022 .The study gives data from the UK from 2008 to 2019.
It is stratified to be representative of the population of the UK by sex, age, region and index of multiple deprivation (IMD).
Exposure to high UPF and high Sodium intake, and outcome BP were recorded.
Age and sex remain important background factors.
This leads to the research question below.

I have used STROBE guidance @elm2007 in producing this report.
This study explored this complex web pulling out strands within it, [diagram 1](fig:diagram%201) shows a possible arrangement of this.

```{r figdiag1, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "diagram 1"
#| fig-cap: "The relationships explored in the analysis"

bp1 <- dagitty(" dag {
               Sodium -> Blood_Pressure
               Age -> Blood_Pressure
               Sex ->  Blood_Pressure
               UltraProcessed_Food ->  Blood_Pressure
             UltraProcessed_Food  <-> Sodium
               Age ->  UltraProcessed_Food
               Sex ->  UltraProcessed_Food 
               Blood_Pressure -> non_communicable_Disease
               Age -> Sodium
               Sex -> Sodium
               
}")
plot(graphLayout(bp1))

```

## Research Question

Using PICO @bruce2018 approach,

In adults and children across the four home nations of the UK between 2008 and 2019, did exposure to high sodium dietary intake, and or high UPF dietary intake, compared to lower exposure, increase the odds of having a mean systolic blood pressure of over 140mmHg?

This primary question can be split into parts,

For a representative population across the UK What was dietary intake of UPF between 2008 and 2019?
What was dietary intake of salt between 2008 and 2019?
What was BP between 2008 and 2019?
What was the correlation between these?

In addition it may be possible to consider, How did each of these change over that time?
Is there evidence of interaction between these?
Was UPF or Na most important in these changes?

## Objectives

1 Literature Review of UPF and BP, with Na

2 Descriptive analysis of participants from NDNS with amalgamation of data across the rolling programme.

3 Analysis of exposure to UPF and Na, and prevalence of BP \>140mmHg using regression models.

4 Discussion of implications of results in relation to limitations of cross- sectional studies, and available data, as well as suggestions for further research

## Epistemology

The epistemological approach of this study is positivist.
I use a quantitative approach in a mechanistic and deterministic model.
However, I am aware that this model is incomplete.
Positivism encourages experimental isolation.
The study is isolated from the world through control of the experimental environment.

Real world dietary change requires understanding interaction with social and economic factors, not isolation.
Critical realist and social constructionist studies are needed to complement the information from this study.
The commercial and social determinants of health are models which have a great deal of impact on exposure to UPF and Na and on dietary effects on BP.

## Positionality

In a positivist paradigm the observer is external to the experiment.
Acknowledging the constructivist aspects to this study allows that the observer is closer to the model making my positionality of interest.
Jafar @jafar2018 argues that understanding the position of the investigator be of interest to understanding this quantitative study.

I bring an attachment to positivist ideals from my biomedical background.
As an older physician I am aware of social factors impacting health of participants as Evans and Trotter @evans discuss.
I also understand that my perception of the world is from a position of significant privilege.
To proceed, I need to be aware of the limitations of the positivist approach.
I need to make pragmatic selections to bring some degree of validity to the resulting dataset.

These constructed ideas, social expectations, income, or geography affect food and health 'choices'.
They also impact on 'hard' clinical measurements such as BP, through physical position and room temperature as well as by the relationship between the observer and the participant.

This work is primarily to complete requirements for an MPH degree which means that it is influenced by factors around health equity and classic epidemiology as taught on the course.
It is produced in collaboration with a research group with a long established reputation in food research in public health, which may steer the results in a conservative direction.

## University Research Governance and Ethical Review

The ethics process for the University of Liverpool was followed and confirmation of compliance is attached at [Appendix 2 Ethics Certificate]

The storage of the data is in keeping with the research governance agreements of the University and the Data set owners.

\newpage

# Literature Review

### Rationale

-   1 develop search
-   2 review search and confirm inclusion
-   3 describe literature
-   4 synthesise literature
-   5 critique literature
-   6 explain role of study within context

This literature review was intended as a systematic search, to identify papers with information about UPF, sodium and blood pressure informed by PRISMA @page2021.

The rationale for this review is to contribute background and to answering the research question;

What is the evidence that in adults and children across the four home nations of the UK between 2008 and 2019, would exposure to high sodium dietary intake, and or high UPF dietary intake, compared to lower exposure, increase the odds of having a mean systolic blood pressure of over 140mmHg?

## Method

Eligible studies were primary research, cohort and cross-sectional studies, and systematic reviews considering the relationship between the exposure, and outcome in comparable general populations.
Papers were excluded where the population was specifically of one type, or had a specified health condition.
Another exclusion criterion was where specific foods were considered.
The search was restricted to human populations.

An additional area of policy and policy implementation was also considered.

Scopus @scopus2 and Medline(ovid) @ovid:se were searched.

The search strategy is included in [table 2.1](#tab:table2) below.
The search identified a wide variety of articles, which outlined and augmented the review.
Others were identified by reading abstracts and cross referencing with other papers.
Colleagues identified further relevant literature.
Additional papers were identified from the bibliographies of relevant papers.
Reviews and meta-analyses presented search strategies and identified highly relevant studies.It has a core systematic approach with additional items from a range of sources.

My search terms

```{r table2, echo=FALSE, message=TRUE, warning=TRUE}
#| tab-id: "tab2"
#| caption: "Description of Search "

#1 	(salt or sodium or Na).mp. [mp=title, book title, abstract, original title, name of substance word, subject heading word, floating sub-heading word, keyword heading word, organism supplementary concept word, protocol supplementary concept word, rare disease supplementary concept word, unique identifier, synonyms, population supplementary concept word, anatomy supplementary concept word] 	

#2 	("BP" or "Blood pressure" or "hypertension" or "high blood pressure" or "systolic").mp. [mp=title, book title, abstract, original title, name of substance word, subject heading word, floating sub-heading word, keyword heading word, organism supplementary concept word, protocol supplementary concept word, rare disease supplementary concept word, unique identifier, synonyms, population supplementary concept word, anatomy supplementary concept word] 	
	
#3 	("ultra-processed food" or "ultra-processed foods" or "ultraprocessed food" or "ultraprocessed foods" or "ultra-processed product" or "ultra-processed products" or "ultra-processing" or "food processing" or "processed food" or "processed foods" or "NOVA" or "NOVA system" or "NOVA food classification" or "NOVA classification system").mp. [mp=title, book title, abstract, original title, name of substance word, subject heading word, floating sub-heading word, keyword heading word, organism supplementary concept word, protocol supplementary concept word, rare disease supplementary concept word, unique identifier, synonyms, population supplementary concept word, anatomy supplementary concept word] 
#4 	1 and 2 and 3 	5 	limit 4 to humans

search1 <- data.table("Name"=c("Date of Search","Database Searched","Search Terms Used","Inclusion","Exclusion","Number of results" ),"Search 1"=c("10/6/23","Scopus","((TITLE-ABS-KEY(salt Or sodium OR Na)) AND (TITLE-ABS-KEY(\"\"BP\"\"OR \"\"Blood pressure\"\"OR\"\"hypertension\"\"OR\"\"high blood pressure\"\"OR\"\"systolic\"\")) AND (TITLE-ABS-KEY(\"\"\"ultra-processed food\" OR \"ultra-processed foods\" OR \"ultraprocessed food\" OR \"ultraprocessed foods\" OR \"ultra-processed product\" OR \"ultra-processed products\" OR \"ultra-processing\" OR \"food processing\" OR \"processed food\" OR \"processed foods\" OR \"NOVA\" OR \"NOVA system\" OR \"NOVA food classification\" OR \"NOVA classification system\")AND ( EXCLUDE ( SUBJAREA,\"\"BIOC\"\" ) OR EXCLUDE ( SUBJAREA,\"\"PHAR\"\" ) OR EXCLUDE ( SUBJAREA,\"\"AGRI\"\" ) OR EXCLUDE ( SUBJAREA,\"\"EART\"\" ) OR EXCLUDE ( SUBJAREA,\"\"VETE\"\" ) OR EXCLUDE ( SUBJAREA,\"\"MATE\"\" ) OR EXCLUDE ( SUBJAREA,\"\"PHYS\"\" ) OR EXCLUDE ( SUBJAREA,\"\"CHEM\"\" ) OR EXCLUDE ( SUBJAREA,\"\"ENER\"\" ) OR EXCLUDE ( SUBJAREA,\"\"ENVI\"\" ) ) )", "ultraprocessed and dietary and prevention or lifestyle", " food technology and processing only, experimental reports using rats, cows rabbits and parrots, those investigating specific foods or food groups, or specific disease groups" ,"385"),"Search 2"=c("11/6/23","Medline(Ovid)","1 	(salt or sodium or Na).mp. 	

2 	(\"BP\" or \"Blood pressure\" or \"hypertension\" or \"high blood pressure\" or \"systolic\").mp. 	
	
3 	(\"ultra-processed food\" or \"ultra-processed foods\" or \"ultraprocessed food\" or \"ultraprocessed foods\" or \"ultra-processed product\" or \"ultra-processed products\" or \"ultra-processing\" or \"food processing\" or \"processed food\" or \"processed foods\" or \"NOVA\" or \"NOVA system\" or \"NOVA food classification\" or \"NOVA classification system\").mp. 
4 	1 and 2 and 3 	5 	limit 4 to humans [mp=title, book title, abstract, original title, name of substance word, subject heading word, floating sub-heading word, keyword heading word, organism supplementary concept word, protocol supplementary concept word, rare disease supplementary concept word, unique identifier, synonyms, population supplementary concept word, anatomy supplementary concept word] ","same","same","211"))
table2 <-width(autofit(flextable(search1)), width=5)
table2 <- set_caption(table2, "Description of Search ", 
  autonum = run_autonum(seq_id = "tab", bkm = "tab2"))
table2
#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/search1.png")
#save_as_image(width(autofit(flextable(search1)), width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/search1b.png")
```

### Selection strategy

Inclusions and exclusions are identified in the table.
No time limits, language limits or availability limits were included in the initial search.

Data collection process the papers were reviewed by the author only.

The key data items sought were odds ratios for the effect of UPF or sodium on blood pressure.

There is risk of bias due to the single reviewer approach.

Data was collated and compared to identify useful odds ratios

There is no agreed approach to reporting exposure or outcome.
This made for a wide variety of difficult to compare items.

### Search results

Search 1 produced 385 results.
204 articles, 77 reviews, 25 editorials, 24 notes, 20 letters, 17 book chapters, 11 conference papers, 6 'short surveys' and 1 book.
These came from 159 institutions, St George's, University of London provided the most with 14.
112 funding bodies were involved, National Heart, Lung, and Blood Institute providing funds for 14.
He, F.J., with 11 papers, was the most represented first author out of 157.

```{r diag4, echo=FALSE, message=FALSE, warning=FALSE}
grViz(diagram = "digraph flowchart {
  node [fontname = arial, shape = rectangle]
  tab1 [label = '@@1']
  tab2 [label = '@@2']
  tab3 [label = '@@3']
  tab4 [label = '@@4']
  tab5 [label = '@@5']
  
  tab1 -> tab2 -> tab3;
  tab3 -> tab4;
  tab3 -> tab5;
}
  
  [1]: 'Initial searches 385 and 211 papers'
  [2]: 'adjusting for overlap 430'    
  [3]: 'reading titles and abstracts 352'  
  [4]: 'systematic reviews 4' 
  [5]: 'cross-sectional 14 or cohort studies 7' 
  ")
```

Search 2 gave 211 papers.
The lists of details from each search were downloaded.
Then the two lists were added together using RefmanageR @mclean14 .
The contents of the resulting file were examined for duplicates.Once these were eliminated the total unique papers was 430.
These were then reviewed by comparing the titles against the inclusion and exclusion criteria.
The remaining literature was still large 380.
Cohort studies 7 and cross-sectional studies 14 were identified within this group.
Several additional relevant studies have also been identified by my supervisors.

## discussion of results

The literature has developed over time.
UPF is a recent concept developed within the NOVA framework, described in 2009, but Dahl's paper @dahl1968 from 1968, identifies the 'artificial' nature of food for infants.
However, articles around UPF and its relation to BP and NCD are more recent.
Importantly they analyse the way that UPF is correlated with BP.

Cohort studies

There were 7 articles identified in the search.
These articles reported on 5 cohorts, @du2014 @du2020 ,USA @Du20213746 , a south african cohort @ware2017 @Charlton2021 , one from Mexico @colin-ramirez2017 , and another from Spain @DeDeusMendonçaRaquel2017Ufca .
Only the spanish study looked at hypertension as an outcome.
The others assessed sodium intake and excretion levels and assumed that this would affect blood pressure.
Du's 2021 study in the USA used CVD as an outcome.

The results identified

+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Cohort               | description           | results                                                                                                                                                                              |
+======================+=======================+======================================================================================================================================================================================+
| China                | Du                    | Sodium intake decreased from 6.3 g/d in 1991 to 4.1 g/d in 2015                                                                                                                      |
|                      |                       |                                                                                                                                                                                      |
|                      | Du                    | Sodium intake is decreasing                                                                                                                                                          |
+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| South Africa         | Ware                  | overall salt intake dropped by 1.15 g/day (P = 0.028)                                                                                                                                |
|                      |                       |                                                                                                                                                                                      |
|                      | Charlton              | Median salt intake (6.8 g/day) was higher in younger than older adults (8.6 g vs 6.1 g/day; p ¡ 0.001), and in urban compared to rural populations (7.0 g vs 6.0 g/day; p = 0.033).  |
+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| USA                  | Du                    | Participants in the highest compared with lowest quartile of ultra-processed food intake had a 19% higher risk of coronary artery disease (HR: 1.19; 95% CI: 1.05, 1.35)             |
+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Mexico               | Colin-Ramirez         | Mean daily sodium intake estimated by three-day food records and 24-h urinary sodium excretion was 2647.2 +/- 976.9 mg/day and 3497.2 +/- 1393.0,                                    |
+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Spain                | de Deus Mendonca      | adjusted HR, 1.21; 95% CI, 1.06, 1.37; P for trend = 0.00                                                                                                                            |
|                      |                       |                                                                                                                                                                                      |
|                      | middle aged uni grads |                                                                                                                                                                                      |
+----------------------+-----------------------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

cross-sectional studies

14 studies were identified as cross-sectional studies on general populations looking at hypertension, sodium, and ultraprocessed food.

| UPF, Na and BP                 | Salt                       | Awareness              | Other conditions         |
|--------------------------------|----------------------------|------------------------|--------------------------|
| barbosa @barbosa2023           | reyhani @Reyhani2020       | ponzo @ponzo2015       | hajmir @Hajmir20223609 , |
| harrington @Harrington20131311 | korff @Korff202045         | westrick @westrick2014 | cunha @cunha2019         |
|                                | johner @johner2015         |                        |                          |
| asma @Asma201949               | quader @Quader20191623     |                        |                          |
| d'avila @davila2017            | jovic @Jovičić-Bata2016651 |                        |                          |

: Cross-sectional studies

The studies looked at awareness, and intake of sodium, UPF, and only a few assessed BP.
Again a clearly stated assumption was that changing salt intake would change BP.
Even when BP or hypertension was explicitly included it was often 'self reported'.
There were 2-3 which were used for this study.

+----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Cohort               | description           | results                                                                                                                                                                                                                    |
+======================+=======================+============================================================================================================================================================================================================================+
|                      |                       | odds ratio (OR)=1.48; 95% confidence interval (CI) 1.14-1.91 and OR=2.17; 95% CI 1.68-2.79, respectively), the consumption of ¿2/day salty snacks (OR=1.86; 95% CI 1.32-2.63 and OR=2.38; 95% CI 1.69-3.37, respectively)  |
+----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                      |                       |                                                                                                                                                                                                                            |
+----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|                      |                       |                                                                                                                                                                                                                            |
+----------------------+-----------------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

: Table of relevant cross sectional studies

### Na, BP, NCD and Public Health

Non-communicable disease (NCD) is an increasing burden on public health.
Cappuccio and Capewell @cappuccio2015 layout the charges against salt clearly.
They identify comprehensively the connection between changes in salt intake and changes in blood pressure and changes in cardiovascular (CVD) and cerebrovascular diseases.
They link the nutritional effect of salt but they also identify the way this is affected by social and commercial determinants of health.
These are branches from different epistemological backgrounds, nutrition from positivism, and the social determinants from a more constructivist approach.

```{r dagNa, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-dagNa"
#| fig-cap: "Diagram of relationships between BP and Salt"

bp2 <- dagitty(" dag {
               Sodium -> Blood_Pressure
               Age -> Blood_Pressure
               Sex -> Blood_Pressure
               Age -> Sodium
               Sex -> Sodium
}")
plot(graphLayout(bp2))

```

Explaining the role of the Framingham studies Kannel @kannel2009 , @kannel1993 and Mahmood @mahmood2014 describe how risk factor medicine came about.
They describe raised blood pressure as a 'prominent member' of a group of risks in cardiovascular disease.
A disease which is the outcome of 'multiple forces'.
Their description sees Framingham as part of the march of progress in understanding cardiovascular disease in particular, but also non-communicable disease.
Kannel identifies that cardiologists alone cannot conquer cardiovascular disease.
Pringle @pringle2003 shows how stroke risk relates to BP.

Since then BP has come to feature more and more in NCD, following studies showing that reducing BP reduced the risk of CVD.
This placed detection, management, and control of BP at the centre of reducing CVD.
Ettehad @ettehad2016 reported a comprehensive systematic review with 123 studies over 49 years and 613815 participants.
In a more contemporary study Debon-Raque et al. @DebonRaquel2020Eoua look at app use to improve BP monitoring.
Bress @bress2021 clearly identifies that patient trust and engagement are essential in reducing 'race' based inequalities.
Boutain @boutain2001 identifies stress and worry as important factors for African American men and women.
In North west England Roche @roche2018 developed quality assurance approaches to BP management which highlight that there are many different approaches to assessment monitoring and control.
The CHAMPS strategy follows on from this work @cvdprev2022.

Satisfactory explanations of the cause of BP depend on the epistemological frame used.
Medically, the causes of BP, as Kannel explains, are divided into secondary BP where there is an identified pathological cause and 'essential' or idiopathic BP where no cause is identifiable.
Contributors to and partial causes of this essential BP have been sought, at individual and societal levels, using medical and epidemiological approaches @who , @bloodpr , @bloodpr2018 .

At the level of physiology, Na is a contributor to BP.
The role of Na in normal and abnormal BP control has been established through WHO and Intersalt @intersal1988 with Elliot @elliott1996 updating the findings and repeating the message.
It is possible to look at these studies and identify areas where clarity is assumed.

News reports such as that of Taubes @taubes2012 and Newman @newman2017 identify question 'orthodox' explanations and seek to disrupt consensus with some degree of success.
Elijovich @elijovich2016 carefully explains how the American Heart Association deals with the idea that there may be individuals with higher sensitivity to salt .
Barris et al. @barris2023 discuss the role of sex in salt sensitivity.
Pitzer et al. @pitzer2022 propose a mechanism of action.

'Lifestyle' causes, such as Boutain's @boutain2001 'stresses', are reported as a mix of personal 'choice', 'behaviours' and responses to other social factors.
That is, they are not choices at all.
Marmot's Whitehall series @marmot1997 @marmot2001 @marmot2015 shows how 'lifestyle' affects BP, CVD and NCD.
This identifies mechanisms for Whitehead @whitehead1988 Dahlgren @dahlgreen2007 and Diderichson's @diderichsen2001 social determinants of health inequalities with their policy approaches and points of intervention.

Whilst Jones et al. @jones2018 demonstrated that there is a cost to adopting dietary recommendations in the UK.
Salisbury's editorial @salisbury2022 discusses how commerce also has a role to play in a causation model which embraces an understanding of causation on a population scale.

Personal choice may be affected by taste sensation and satiety.
Tan @tan2021 discovered that this is difficult to study with a wide range of approaches across their systematic review.
Nakamura et al. @nakamura2022 used NDNS to explore how alternative flavourings might reduce the use of salt.

Reducing salt intake works to reduce BP.
Vollmer @vollmer2001 reports findings that reduced salt intake can reduce BP in diverse groups in the USA.
Hendriksen @hendriksen also explored this using Dutch and other European data to support this.
Laverty et al. @laverty2019 demonstrate how policy reduces salt intake, and how reversal of policy allows intake to increase again.
They also show how that affects BP.

### NOVA

The NOVA classification, of Monteiro @monteiro2009, looks at food beyond the nutrient level.
At the level of 'processing'.
Group one are foods which are in a natural state, as plucked from the tree.
Group two is foods which are used in processes to modify group one foods.
Group three initially was all other foods, but was soon separated into minimally processed foods, and group four the ultra-processed foods.
Increased NOVA category four food intake, or UPF, is associated with risk of hypertension in some groups around the world.

As the NOVA concept has developed it can also be seen that 'processsing' incorporates how food is made available within social systems, how consumption behaviour changes in cooking and eating behaviour within social systems.

Though processing is important to the concept of UPF, Tulleken @tulleken2023 describes UPF in nutritional terms quoting Rauber identifying 'industrially produced edible substances'.

### The 'controversy' of Food classification

Martinez @martínez2021 makes an attempt to develop 'ecofoodomics' by deconstruction.
His neologism can receive a new more inclusive epistemology of food.
His 'knowledge of food' branches into food as culture, food as biologic, and food as economic.
Nutrition would sit strongly within a biologic category, but UPF intentionally carries economic aspects, and cultural aspects.
this epistemology reflects the ontology, the essential nature of food is multidimensional in the same way as knowledge about it.

Meghani @meghani2007 expresses this same idea using examples actually a little way along the food chain.
Identifying that there is a conceptual mismatch between the different parties in these arguments.
It is essential that 'pure' scientists engage with the cultural and socioeconomic aspects of their science, to highlight this to direct societal and political activity.

Cifuentes @cifuentes2020 claims 'foodomics' as a descriptor of the pure science aspects of food.
This shows the difficulty of defining this field.

Bearing in mind cultural and economic dimensions of food it becomes easier to understand that researchers don't always view food in the same way as people do, or as each other.
Romero et al. @romeroferreiro2021 compare Nutri-Score and NOVA.
Nutri-Score concentrates on nutritional analysis and identification to 'enable consumer choice'.
Their analysis shows how foods classified nutritionally end up in all four of the NOVA categories.
Asma et al. @A.Asma2019Fcsb as many other researchers found the concept of processing of food helpful in categorising their participants.

Bourdieu @bourdieu2002, @abourdi2021 identified how food and food culture is associated with social position and how society is structured at a fundamental level.
This includes that there is a two way process at work.
Food preferences can change social position, as social position can be changed by food preferences.

Cuj et al @cuj2021 support this idea that nutrition is limited when only the chemical composition is studied.
Haber et al. @haber1977 review the role of structural arrangement of nutrients and how this alters speed of delivery of nutrients, venous glucose profile and resulting satiety.
This breaks apart the idea of the nutritional content being the sole identifier of value for a food within a biological paradigm.
Structure is important too.

Dickie et al. @dickie2023 , @dickie2022 tried to develop a system to describe healthy foods, but struggled to build a model which was any more effective than NOVA.
Each model demonstrated the similar 'flaws' around different 'bad' foods being made 'good' by the classification scheme.
Martinez @Martinez-PerezCelia2021Uodf also describes trying to use different classification schemes to describe all the health related aspects of food.

Monteiro's initial explanation uses the concept of 'processing' @monteiro2009 , and revised after initial reviews @monteiro2010.
This second version is the first that knowingly separates processed and ultraprocessed food.
Identifying that whilst some processing might be of value, there is a threshold where risk increases.
By 2013 @monteiro2013 the value of the model was becoming clearer.
This idea was more confidently expressed by 2016 @monteiro2016.
Even at this stage there is a bio-reductionist explanation around UPF.
The 'value' of a scientific cache is too strong.

In a recent debate Monteiro @monteiro2022 and Astrup @astrup2022 discuss the concept of UPF and if it is valid or useful.
There is a lot agreed about the necessity and importance of processing.
Contended areas include confidence in the fundamental ideas, and in the approach to improving food quality of production, supply, and consumption.
The areas of contention seem to identify differing epistemological approaches.
On one side there is a confidence in a positivist solution to the social questions asked.
The other identifies with a multi-paradigm approach.

This conflicting conversation is evident across the scientific and lay discourse around UPF.
Using Martinez's approach we can see the confusion is brought about because of differing assumptions about the epistemological basis of the parties.
In particular the value they all hold for biologic-positivist purity.

### How is UPF different?

Explanations for the differential effect of these foods have developed as quickly as new ultra-processed foods have been developed .

Aceves-Martins @aceves-martins2022 asks is it due to nutritional content ?
In 2019 Rauber et al @rauber2019 ask, is it due to effects on satiety, or changes to appetite ?
Do they taste better asks BawaJeeh et al. @bawajeeh2021 ?
With Wang et al. @wang2021 considering, Is it due to being easy to buy, and easy to eat?
Is it because they don't require time and effort in the home to process?
Is it because these processes are industrial?
Is it because these foods contain 'chemicals' or new ingredients?
These explanations move from nutritional through into social and commercial.

Colombet @colombet2022 showed that household income is correlated with UPF intake in the UK identifying a social dimension.
This was also shown in the French West Indies @colombet2019 describing a 'nutrition transition', a historic societal change.

Nutrition based classifications appear less socially divisive due to scientific isolation.
They still contain elements of social factors.
One example is the way that foods are analysed can change their reported nutritional content.
Eg a 'standard' food may be compared to a 'traditionally prepared' food.
The first is prepared in a factory with control of its nutrition, the second by a home cook with limited access to nutrition modification technology.

Statements about NOVA discuss high salt and sugar content.
Webster @websterSystematicSurveySodium2010 and niMurchu @nimhurchu2011 identify the large amount of salt in ultraprocessed foods.
Vargas @Vargas-MezaJorge2022DSaP concentrates on sodium and potassium using the Mexican national health and nutrition survey.

Sugars are the focus for Rauber @rauber2019, particularly free sugar intake.

Papers describe content, discuss the effect on physiology, and pathology, but rarely develop their analysis.
They do not show that the sodium, and UPF together increase the risk of CVD, or BP rise.
This dissertation intends to address this gap.

Byker-Shanks et al. @bykershanks2022 show an approach between individual action and changing laws.
This approach would target those most at risk due to negative social determinants.
It does move into the realm of coercion of those 'making the wrong choices' into making better choices.
It is a pragmatic response to manipulating the strange food economy described by Dimblebey @dimbleby.
Armendariz @armendariz2022 looks at how the retail food environment in Mexican cities has changed and how it affects BP.

### UPF and Ill Health

```{r dagupf, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-dag-upf"
#| fig-cap: "Diagram of possible relationships of UPF"

bp3 <- dagitty(" dag {
             
               Age -> BP
               Sex -> BP
               UPF -> BP
              Age -> UPF
               Sex -> UPF
               BP -> NCD
              
}")
plot(graphLayout(bp3))
```

Dicken and Betterham @dicken2021 provide a comprehensive review of papers considering a range of metabolic and other health endpoints.

Mertens @mertens2022, Barbosa @barbosa2022, Santos @SantosFrancineSilvaDos2020Fpac ,Aceves-martins @aceves-martins2022, and Rauber @rauber2020 explore how UPF are associated with poor health.
Whilst this is primarily metabolic pathology they do often mention BP.
Schulze @schulze2019 comprehensively reviews UPF and metabolic health.

Oliveira et al @OliveiraTafnes2020CtCo try to identify ill health in young people associated with the increasing use of UPF.

Hodge @HodgeAllison2021ITIU dedicated an edition of 'Public Health Nutrition' to this question

#### obesity

The link to obesity is perhaps the most direct.
Munoz @Muñoz-LaraA2020TCOU looked at Mexican school age children.
Li @LiMing2021Ufca looked at adults in China.
Rauber @rauber2020 used the NDNS study to look at obesity in the UK.
Each finding links to increased UPF and increased BMI and odds of being obese, often related to increased energy intake.
UPF with its nutritional, cultural, and economic parts increases obesity.
Critical review of UPF findings almost always include 'what is the mechanism?'
as an early question.
We can now ask this question in three parts.
How much of the mechanism is biologic, how much cultural and how much economic?

#### diabetes and cardiometabolic syndromes

Given the effects on obesity and the increase of energy intake the connection to diabetes and cardiometabolic syndromes has been the subject of more papers.

Aguiar @AguiarSarmentoRoberta2018EPaH concentrates on diabetes only.
Li @LiMing2022AbUF uses a national study to link UPF with diabetes in China.

de Miranda Renata Costa @deMirandaRenataCosta2021Iouf identifies the effect on metabolic health.
Martinez @Martinez-PerezCelia2021Uodf connects the dietary share of UPF in the US population.
Tavares @TavaresLetíciaFerreira2012Rbuf doing the same in Brazilian adolescents.

dos Santos @dossantos identifies this as cardiometabolic health and provides a systematic review @SantosFrancineSilvaDos2020Fpac .
Goodman et al @GoodmanDina2020Diac explore this in Venezualan adults.
Vilela @VilelaSofia2022Eotf give a '...prospective approach to childhood'.

Some authors look how these metabolic effects lead to other conditions.
For example Weinstein @WeinsteinGalit2021Couf with dementia.
Gomez-Smith @Gomez-SmithMariana2018RCRa identify a possible pathological explanation.
Ivancovsky @IvancovskyWajcmanDana2021Ufia connects non- alcohol fatty liver disease (NAFLD).
Lee @LeeHae-Young2022UFaa connects these to CVD.

Colombet @colombet2019 connects these changes in metabolic syndrome with changes in socioeconomic inequalities again linking the nutritional identity of diet with its social aspects.

#### cancer

Southall @southall2022 and seperately Wang @wangAssociationUltraprocessedFood2022 have identified a risk of colorectal cancer.

#### ckd

Kityo @KityoAnthony2022TIoU identifies the effect on the kidneys.
Identifying the diverse effects of UPF and possibly also another contributory cause of BP changes.

### UPF BP and Na

```{r figdagupfbp, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-dagupfbp"
#| fig-cap: "Diagram of relationship between Na and UPF and BP"

bp6 <- dagitty(" dag {
               Na -> BP
               UPF -> BP
               UPF <-> Na
               BP -> NCD}")
plot(graphLayout(bp6))

```

Many studies show the increasing role of UPF within the diet.
Mertens @mertens2022 and ni Mhurchu @nimhurchu2011 show how UPF are being eaten in ever greater quantities across Europe but especially across the UK.

Wang @wang2021 identifies increasing consumption in US youths, D'Avila @DavilaHelenFreitas2017Eifu also identify that increasingly upf are the key source of energy in adolescents.
Gupta @GuptaDeepanshi2021Sauf explores the role of youth, identifying the peculiar age distribution of UPF intake.

Rauber @rauber2019 look instead at free sugar intake.

Studies have started to find that hypertension is associated with increased intake of UPF in North and South America (Scaranni @scaranniUltraprocessedFoodsChanges2021a and de Deus Mendonca @DeDeusMendonçaRaquel2017Ufca), Europe and in Asia Shim et al. @shimConsumptionUltraProcessedFood2022 provide a Korean perspective.Du @du2014 gives the data for China).
Wang @WangMei2022UFCI delivers a meta analysis and systematic review.

The definition of hypertension is contentious with many studies using self identification, or historical physician diagnosis.
There is also a distinction between pathology, and physiology.
Some papers identify hypertension as a pathological state and exclude it from analysis, others include participants on medication which alters BP value, in others 'hypertension' is the outcome measure irrespective of BP value.

What is the mechanism by which UPF causes BP?
How much of it is nutritional?
After excluding the nutritional dimension is there a further UPF effect?
Most studies don't include sodium intake in their analysis.

Before UPF, Suter @suterNutritionalFactorsControl2002a asked is hypertension and blood pressure nutrient based, is it mediated by Salt?

Is it other factors such as the food sales environment as explored by Goncalves @GonçalvesVivianSS2019Cots ?

Oliveira @OliveiraTafnes2020CtCo looks at the effect in children, Rezende @Rezende-AlvesKatiusse2021Fpar with adolescents.

Lima @LimaR2011Pouf reviewed already hypertensive individuals.

These papers answer to a connection between UPF and Hypertension.
They leave the next obvious question to brief speculation and future research.
Their offer is that UPF are high in Salt and sugars.
The question is dropped, the focus elsewhere.

Smiljenac @smiljanec2020 and Tzelfa @TzelefaVicky2021Aodp both look at how UPF affect the vasculature which may be part of the pathway to BP.
This looks further along the causal chain within the nutritional biologic domain of food science.

### Approach to change

Understanding the best approaches to reducing salt requires approaches that also cross epsitological paradigms.
As well as biologic, we need cultural and economic approaches.
Indeed it may be that all the science will never make changes in behaviour and regulation in isolation, but may require addressing the cultural and economic.

The relationship between Na and socioeconomic position was demonstrated by Ji et al. @ji2014.

Is it best to get individuals to reduce intake( @yourgui1998, @reports2023 , @vollmer2001 , @sacks2001 , @NilsonEduardoAugustoFernandes2021Eprd ), or for all of the food industry to reduce salt levels Cappuccio @cappuccio2011 ,and He @he2010 .
Critics often identify 'reformulation', reducing the Na content of UPF, delivering an even more processed 'industrially produced edible substance'.

Lifestyle factors are contented.
Whilst individual choice is involved.
The range of choices available to individuals is limited by the nature of their society.
A misapplication of 'lifestyle' results in blaming individuals for 'poor choices' determined by their social and commercial environment.
Iso @iso1999 looks at how education may be effective in delivering change.

A comprehensive integrated policy approach such as 'healthy cities' @healthy2017 is proposed.
Macregor @macgregor2015 explores how political change affects both the process and outcome of population level approaches to improving health.

Instead of trying to change activity of millions of people.
It can be more effective to change laws and policies once @instituteofmedicine2010 , @millett2012 , @moreira2015 , @instituteofmedicine2013 .
These 'upstream' changes are simple changes.
Though might require social and political approaches to achieve.
They are much more effective, though they can also be reversed eg Cappuccio @cappuccio2015 .
Cost is one of the causes of change as shown by Jones @jones2018 using NDNS to identify the cost premium of a good diet as defined by UK dietary recommendation .
Opposition sometimes comes from industry.

Laverty @laverty2019 and Macgregor @macgregor2015 showed that analytical models can effectively demonstrate the effects of different policies on population health.
They identify that reducing the effectiveness of a policy on salt in food leads to changes in BP and so on to NCD.

Campos-Nonato @campos-nonato2022 identify the benefits of their strategy.
They discuss the range of nation level approaches to reducing salt intake.

Dimbleby's @dimbleby National food strategy is an example of a high level approach to tackling biologic, cultural and economic aspects of food in order to improve all these factors and so reduce the burden of ill health and NCD across the population.

Tulleken's @tulleken2023 'ultraprocessed people' presents a case for stopping the use of UPF.
He supports individual choice, but identifies that a whole systems approach involving governmental partners is essential.
He argues largely within the biomedical paradigm.

## Literature review Conclusion

The literature review identified and analysed a range of literature across the field.
Key points being that CVD is a significant NCD, and has links with Na and UPF.
These links are often described from different epistemological viewpoints within the study of food.
This study aims to look at how Na and UPF interact and looking to understand from a positivist approach what are the effects UPF.
Whilst knowing and accepting that effects of UPF in this paradigm are a subset of their total effect, which also includes cultural and economic aspects.
Also understanding that Na in its nutritional paradigm similarly projects into the cultural and economic.
Only by understanding biologic, cultural and economic aspects of food can we mange change to reduce the burden of disease.

\newpage

# Method

## Study Setting and Design

This is a secondary data analysis of data from the National Dietary and Nutritional Survey (NDNS @universityofcambridge2022).
This analysis is designed to analyse the correlation between sodium intake, UPF intake and BP.

The NDNS was commissioned in collaboration between government departments responsible for health and for food production.
Academic partners delivered reports on diet and nutrition across the United Kingdom.
The study is designed to be representative across the four home nations, and across age with balanced representation for children.
NDNS data are available via the UK national Data service for research purposes.

NDNS is a rolling cross-sectional study, in each year a new cross section of participants is enrolled from the wider population.
Questionnaires, food diaries, and nurse assessments are used to gather data.
It has been running since 2008.
The most recent data is available from 2019.

## Participants, Inclusion and Exclusion

Participants were identified by random selection across postal units.
The sample is stratified to ensure a representative sample across the four nations (England, Wales, Scotland, and Northern Ireland) and across regions in England (North West, North East, Yorkshire and Humberside, East Midlands,West Midlands, London, The South East, The South West).
The sample is also stratified for age and sex and IMD.

For NDNS the intended sample is 1000 per year with 50% adults.
Each year the sample is slightly different due to differential uptake.
Oversampling is used to control this.

The relationship between salt and systolic blood pressure may be different in individuals with pathologically high BP.
Those taking BP controlling medications may have a different relationship to sodium and UPF and were excluded for analysis.

## Exposure Variables

The participants recorded their food intake prospectively over 4 days recording food and portion size as well as where food was eaten.
Adults recorded this for the child participants.

Based on the food and drink intake reported and with a composition data table, the NDNS team have estimated the overall intake of a large range of nutrients.

### Salt estimation

The sodium milligram (mg) value (Na) was calculated from intake.
Food diaries were analysed against standard food nutrient values.
Hence, this value reflects the expected Na content of standard foods.
It assumes the content remains consistent.

Serum sodium values are available for the early dataset, but not the later one.
24 urinary sodium is a better indicator of dietary sodium but values are not available across the whole time period.

### UPF

The NOVA classification was used to estimate the intake of UPF developed by Monteiro et al. @monteiro2010.
There is no record of NOVA classification in NDNS.
The dataset provided by Dr Colombet (personal communication) was used to identify food by NOVA group.
This was developed by comparing every food level entry in NDNS against NOVA.
A standard methodology describing the approach used has been published by Martinez-Steele et al. @martinez-steele2023 .

Next the energy content of the day's food was calculated by Nova group.
This was added to the intake for the other 3 days and the total intake by Nova group established.
The percentage of the total intake of energy was then calculated for each of the 4 Nova categories.
Nova group 4 or UPF intake (UPF) is used for this study.

## Outcome Variable

BP is a quality assured mean systolic BP which is reliable across the dataset.
It was measured in mmHg using a calibrated automatic sphygmomanometer by a study nurse under specified conditions.
These conditions controlled for the effects of exercise, temperature and ill health.
The data on all these is in the dataset.
Raw BP values are also present in the dataset to allow quality review.

## Other Variables

Additional explanatory variables are ones which can also influence BP.
They include Age, Sex, and BMI.
Age at completion of education (educfinh), and Index of multiple deprivation (IMD) are also used.
Participants on BP medication (bpd) is used to exclude those taking medication which may lower their BP.

## Data Sources

The data from the NDNS study contains information about each individual, and their household.
This was collected through questionnaires.
Then weight, height, and blood pressure were measured by a nurse.
Finally, dietary information was collected through a 4-day food diary.

The food was analysed for nutritional content using a bespoke database.
These reference tables are available in the available dataset.

Data was not available for some categories and years.
This was identified in tables as missing data.

## Bias

Selection bias was approached by using random selection of participants using a carefully constructed stratification model.
Addresses were selected by postal units to ensure geographic spread of participants.

Take up and Drop out bias was approached by ensuring that sample sizing included scope for this to enable comparable sample sizes across annual waves.

Social desirability bias acknowledges that participants remember and record intake framed by their beliefs about the needs of the study, and their beliefs about what is percieved as being healthy.
To examine this, in the first wave a double labelled water study was incorporated.
This compared reported energy intake with measured values @lennox .

Finally bias at the analysis stage used weighting to standardise the sample for several variables.
Those selected were Age, Sex, region and IMD.
Weights are available for different levels of analysis as participants who did not complete the initial interview were not selected for subsequent blood analysis.

## Quantitative variables

A categorical variable (hiNa), has been produced with a cut off values at 3000mg, 5000mg and 6000mg.
These values are the WHO recommended amount and match values used in Du et al @du2014.

A variable (UPF3) was developed from the mean UPF intake.
The central category is the mean with one standard deviation above and below.
This effectively identifies 67% in the centre of the distribution.
Categories used in other papers eg @WangMei2022UFCI are low for the UK.

I have created a variable (hyp) which identifies participants with BP over 140 mmHg to enable logistic regression.
This value is identified by Du et al (@du2014) and others.

## Study Size

A sample size calculation for this secondary analysis is available in appendix 1 the initial proposal from OpenEpi @openepi2021 .
This calculated the sample size of 3526, with a ratio of 0.75 unexposed to exposed.
An intended power of 80%, at a level of statistical significance of 95% was used.
An odds ratio of 1.2 was used based on a meta-analysis by Wang et al @wangUltraProcessedFoodsConsumption2022 .

## Statistical Methods

Four data batches of data ( 2008-2012, 2013-2014, 2015-2016, 2017-2019) were combined.
The data was read using 'r-studio' with the processing being carried out using packages (see appendix 3) available from CRAN @base.
In particular the package 'survey' @survey2004 was used to manage weighted data.
Generated weighting values account for differences uptake and drop out across the annual cohorts.
'Survey' also accounts for sample stratification.

Data was analysed for correlation by regression.
Categorical data was analysed using chi-squared.
In all analysis P.values and confidence intervals were calculated and a value of p \< 0.05 was taken as the threshold of statistical significance.
Multivariable regression models were constructed to manage variables which might have confounding effects on the outcome of the analysis.
Sample stratification was also used to reduce potential confounding.
Tables of results were produced to best demonstrate the data.
For the main results a set of multivariable logistic regression models was developed.
Each exposure variable was modelled separately, the final model included both of the exposure variables.
AIC was used to understand the relative importance of variables.

```{r readdata, message=FALSE, warning=FALSE, include=FALSE}

sav4 <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_personleveldietarydata_uk_v2.sav"

sav4b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_indiv_uk.sav"

sav6 <-"/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_personleveldietarydata_v2.sav"

sav6b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_indiv.sav"

sav8 <-"/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_personleveldietarydata.sav"

sav8b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_indiv.sav"



sav11 <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr9-11a_personleveldietarydata_uk_20210831.sav"

sav11b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr9-11a_indiv_20211020.sav"

sav4r <- as.data.table(read_sav(sav4))
sav4br <-as.data.table(read_sav(sav4b))

sav6r <- as.data.table(read_sav(sav6))
sav6br <-as.data.table(read_sav(sav6b))

sav8r <- as.data.table(read_sav(sav8))
sav8br <-as.data.table(read_sav(sav8b))


sav11r <- as.data.table(read_sav(sav11))
sav11br <- as.data.table(read_sav(sav11b))
sav11br$area <- sav11br$Area
```

```{r stdnames4, message=FALSE, warning=FALSE, include=FALSE}
#standardise the variable names for grp 1-4 
sav4br$bpmedc2 <- sav4br$bpmedc
sav4br$bpmedd2 <- sav4br$bpmedd
sav4br$diur2 <- sav4br$diur
sav4br$beta2 <- sav4br$beta
sav4br$aceinh2 <- sav4br$aceinh
sav4br$calciumb2 <- sav4br$calciumb
sav4br$obpdrug2 <- sav4br$obpdrug

sav4br$ethgrp5 <- sav4br$ethgr5
sav4br$ethgrp2 <- sav4br$ethgr2

sav4br$hyper140_2 <- sav4br$hyper140
sav4br$hibp140_2 <- sav4br$hibp140
sav4br$hyper1_2 <- sav4br$hyper1
sav4br$highbp1_2 <- sav4br$highbp1

sav4br$educfinh <- sav4br$EducFin
sav6r$SurveyYear <- sav6r$Surveyyear
```

```{r stdnames11, message=FALSE, warning=FALSE, include=FALSE}
sav11br$htval <- sav11br$htval2
sav11br$wtval <- sav11br$wtval2
sav11br$bmival <- sav11br$bmival2

sav11br$gor <- sav11br$GOR
sav11br$age <- sav11br$AgeR
sav11r$Age <- sav11r$AgeR
#sav11br[omsysval <= 10, omsysval := NA]
```

```{r novafile, message=FALSE, warning=FALSE, include=FALSE }
NOVA_ForDavid <- as.data.table(read_excel("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/NOVA_ForDavid.xlsx"))

NOVA_ForDavid[, Sex := factor(Sex, levels = 1:2)]
NOVA_ForDavid[, Country := factor(Country)]
NOVA_ForDavid[, SurveyYear := factor(SurveyYear)]
NOVA_ForDavid[, Age := as.numeric(Age)]
```

```{r weight, echo=FALSE}
#Doing the weighting correction, as explain in the PDF "6533_ndns_yrs9-11_weights_guide"

n1 = sum(sav4br$wti_UKY1234)  #Should be 6828

n2 = sum(sav6br$wti_Y56)         #Should be 2546

n3 = sum(sav8br$wti_Y78)         #Should be 2723

n4 = sum(sav11br$wti_Y911)       #Should be 3558

N <- sum(n1, n2, n3, n4) #Should be 15655
```

```{r weight2,message=FALSE, warning=FALSE, include=FALSE}
#now the proportion weight for each is calculated
sav4br$wti_UKY1to11 <- ((sav4br$wti_UKY1234/n1) * N)  * (4/11)

sav6br$wti_UKY1to11 <- ((sav6br$wti_Y56/n2) * N) * (2/11)

sav8br$wti_UKY1to11 <- ((sav8br$wti_Y78/n3) * N) * (2/11)

sav11br$wti_UKY1to11 <- ((sav11br$wti_Y911/n4) * N) * (3/11)

```

```{r allsetupvariables, message=FALSE, warning=FALSE, include=FALSE}
 #measured and recorded data yr1-4a_indiv_uk 
#subsets of the table to identify grouped information
bpset <- c("seriali","omsysval","omdiaval")
ethnset <- c("ethgrp5","ethgrp2")
saltset <- c("SaltChk","SalHowC","SltSHow" ,"vegetarn")
medsset <- c( "bpmedc2","bpmedd2","diur2","beta2","aceinh2", "calciumb2","obpdrug2", "PregNowB")
hypset <- c("hyper140_2", "hibp140_2", "hyper1_2", "highbp1_2")
incset <-c("nssec8","gor","region", "EIMD_2007_quintile","EIMD_2010_quintile","EIMD_2015_quintile","WIMD_2014_quintile","SIMD_2016_quintile","NIMD_2017_quintile","educfinh")
measset <- c("htval","wtval","bmival")
ageset <- c("agegad1", "agegad2", "agegch1","agegr1","age")
weightset <- c("wti_UKY1to11","astrata1","area")

indiv_data <- c(bpset,ethnset,saltset,medsset,hypset,incset,measset,ageset,weightset)
```

```{r individdata,message=FALSE, warning=FALSE, include=FALSE}
sav11br <- sav11br[,..indiv_data]
sav4br <- sav4br[,..indiv_data]
sav6br <- sav6br[,..indiv_data]
sav8br <- sav8br[,..indiv_data]

val_labels(sav8br) <- NULL
val_labels(sav6br) <- NULL
val_labels(sav4br) <- NULL
val_labels(sav11br) <- NULL
#sav8br$seriali <- as.double(sav8br$seriali)
#sav8br$ethgrp5 <- as.double(sav8br$ethgrp5)
```

```{r joiningtogether,message=FALSE, warning=FALSE, include=FALSE}
#this creates the whole table
ndns_1_11 <- rbindlist(list(sav4br,sav6br,sav8br,sav11br),fill = TRUE, use.names = TRUE)

```

```{r definefactors,include=FALSE}
 #define factors for 1-4 
#saltset
ndns_1_11[, SaltChk := factor(SaltChk, levels = 1:8, labels = c("Salt",
	"Salt substitute",
	"Neither",
	"Item not applicable",
	"No answer/refused",
	"Don't know",
	"Qn not applicable to survey year",
	"Schedule not applicable"))]
 ndns_1_11[, SalHowC := factor(SalHowC, levels = 1:8,labels = c("Always",
"Usually",
"Sometimes",
	",Item not applicable",
	"No answer/refused",
	" Don't know",
"Qn not applicable to survey year",
"Schedule not applicable"))]
 ndns_1_11[, SltSHow := factor(SltSHow,levels = 1:8,labels = c("Always",
                                                            "Usually",
                                                            "Sometimes",
                                                            ",Item not applicable",
                                                            "No answer/refused",
                                                            " Don't know",
                                                            "Qn not applicable to survey year",
                                                            "Schedule not applicable"))]
 
 ndns_1_11[, vegetarn := factor(vegetarn, levels = 1:3, labels = c("vegetarian","vegan","not vegetarian"))]
```

```{r definefactors2 ,include=FALSE}
#medset
 ndns_1_11[, bpmedc2 := factor(bpmedc2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
 ndns_1_11[, bpmedd2 := factor(bpmedd2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, diur2 := factor(diur2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, beta2 := factor(beta2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, aceinh2 := factor(aceinh2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, calciumb2 := factor(calciumb2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, obpdrug2 := factor(obpdrug2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, PregNowB := factor(PregNowB,levels = 1:2,	labels = c("preg or breastfeeding"
	,"not preg or Bfeed"))]
 
 


 
 
 
#incset
  
 
ndns_1_11[,gor := factor(gor, levels = 1:12, labels = c("England:North East","England:North West","England:Yorkshire & The Humber","England:East Midlands","England:West Midlands","England:East of England","England:London","England:South East","England:South West","Wales","Scotland","Northern Ireland"))]


ndns_1_11[,region := factor(region, levels = 1:6, labels = c("England: North","England: Central/Midlands","England: South(including London)","Scotland","Wales","Northern Ireland"))] 
  
ndns_1_11[, EIMD_2007_quintile := factor(EIMD_2007_quintile, levels = 1:5)] 
ndns_1_11[,EIMD_2010_quintile := factor(EIMD_2010_quintile, levels = 1:5,labels = c(Label = "0.53->8.49 [least deprived]", "8.49->13.79","13.79->21.35","21.35->34.17", "34.17->87.80 [most deprived]"))] 
ndns_1_11[,EIMD_2015_quintile := factor(EIMD_2015_quintile, levels = 1:5,labels = c(Label = "Most deprived", "2","3","4", "least deprived"))] 
ndns_1_11[,SIMD_2016_quintile := factor(SIMD_2016_quintile, levels = 1:5,labels = c(Label = "Most deprived", "2","3","4", "least deprived"))]
ndns_1_11[,WIMD_2014_quintile := factor(WIMD_2014_quintile, levels = 1:5,labels = c(Label = "Most deprived", "2","3","4", "least deprived"))]
ndns_1_11[,NIMD_2017_quintile := factor(NIMD_2017_quintile, levels = 1:5,labels = c(Label = "Most deprived", "2","3","4", "least deprived"))]

ndns_1_11[,educfinh := factor(educfinh, levels = 1:8, labels = c( "Not yet finished",
"Never went to school"
,"14 or under"
,"15","16","17","18","19 or over"))] 
ndns_1_11[,nssec8 := factor(nssec8, levels = 1:8)] 
#bpset 
 
#ndns_1_11[, "omsysval" := as.numeric(omsysval)]


 #hypeset
ndns_1_11[,hyper140_2 := factor(hyper140_2,levels = 1:9, labels = c(" Normotensive untreated",
" Normotensive treated",
	"Hypertensive treated",
"Hypertensive untreated",
"No answer/refused",
	"Don't know",
"Refused, attempted but not obtained, not attempted",
	 "Qn not applicable to survey year",
"Item not applicable")) ]
 ndns_1_11[, hibp140_2 := factor(hibp140_2, levels = 1:7, labels = c("Not high BP",
"High BP",
	"No answer/refused",
	"Don't know",
	"Refused, attempted but not obtained, not attempted",
	"Qn not applicable to survey year",
	"Item not applicable")) ]
ndns_1_11[, hyper1_2 := factor(hyper1_2,levels = 1:9, labels = c(" Normotensive untreated",
                                                          " Normotensive treated",
                                                          "Hypertensive treated",
                                                          "Hypertensive untreated",
                                                          "No answer/refused",
                                                          "Don't know",
                                                          "Refused, attempted but not obtained, not attempted",
                                                          "Qn not applicable to survey year",
                                                          "Item not applicable"))]
 ndns_1_11[, highbp1_2 := factor(highbp1_2, levels = 1:7, labels = c("Not high BP",
                                                              "High BP",
                                                              "No answer/refused",
                                                              "Don't know",
                                                              "Refused, attempted but not obtained, not attempted",
                                                              "Qn not applicable to survey year",
                                                              "Item not applicable")) ]
 
 
 
 
  
#ethnset  

ndns_1_11[ , ethgrp5 := factor(ethgrp5, levels = 1:5, labels = c( 'White'
                                                             , 'Mixed ethnic group'
                                                             , 'Black or Black British'
                                                             , 'Asian or asian British'
                                                             , 'Any other group'))]
ndns_1_11[ , ethgrp2 := factor(ethgrp2, levels = 1:2, labels = c( 'White'
                                                             , 'Non-white'))]




#ageset
ndns_1_11[,agegad1 := factor(agegad1, levels = 1:4 ,labels = c("16-24","25-49","50-64","65+ years"))]
ndns_1_11[,agegad2 := factor(agegad2, levels = 1:5, labels = c("16-18","19-34","35-49","50-64","65+ years"))]
ndns_1_11[,agegch1 := factor(agegch1, levels = 1:3, labels = c("8-10","11-12","13-15"))]
ndns_1_11[,agegr1 := factor(agegr1, levels = 1:5, labels = c("1.5-3 years","4-10 years","11-18 years","19-64 years","65+ years"))]
 




 
```

```{r personaldatadefn,include=FALSE}
#this identifies the variables wanted from the person level data sets
perslevdat <- c("seriali","Age","SurveyYear", "Sex","Country","Sodiummg","Calciummg","VitaminDµg","TotalEMJ", "Totalsugarsg","Glucoseg","Sucroseg","Fructoseg","Lactoseg","SOFTDRINKSLOWCALORIE","SOFTDRINKSNOTLOWCALORIE", "TEACOFFEEANDWATER")



```

```{r joinpersleveldata,message=FALSE, warning=FALSE, include=FALSE}

val_labels(sav8r) <- NULL
val_labels(sav6r) <- NULL
val_labels(sav4r) <- NULL
val_labels(sav11r) <- NULL

 sav4r$Sex <- as.numeric(sav4r$Sex)
sav6rSex <- as.numeric(sav6r$Sex)

#building the tables
sav4r <- sav4r[, ..perslevdat]
sav6r <- as.data.table(sav6r[, ..perslevdat])
sav8r <- as.data.table(sav8r[, ..perslevdat])
sav11r <- sav11r[,..perslevdat]


val_labels(sav8r) <- NULL
val_labels(sav6r) <- NULL
val_labels(sav4r) <- NULL
val_labels(sav11r) <- NULL

ndns_1_11r <- rbindlist(list(sav4r,sav6r,sav8r,sav11r),fill = TRUE, use.names = TRUE)

ndns_1_11 <- ndns_1_11[ ndns_1_11r, on = "seriali"]



```

```{r tidyup, echo=FALSE}

ndns_1_11[, Sex := factor(Sex, levels = 1:2, labels = c("Male", "Female"))]
ndns_1_11[, Country := factor(Country)]
ndns_1_11[, SurveyYear := factor(SurveyYear)]
ndns_1_11[omsysval <= 10, omsysval := NA]


upfd <- c("seriali","NOVA_Epct_opti_4","NOVA_Gpct_opti_4")
NOVA_ForDavid <- NOVA_ForDavid[,..upfd]
#NOVA_ForDavid
ndns_1_11 <- ndns_1_11[NOVA_ForDavid, on = "seriali"]
```

```{r loadfooddiarydata, message=FALSE, warning=FALSE, include=FALSE}
UPFNOVA <- data.table(read_excel("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/altquant/UPFNOVA.xlsx"))
#ndns_yr1_nutrientdatabank <- data.table(read_sav("UKDA-6533-spss/spss/spss25/ndns_yr1_nutrientdatabank.sav"))

#ndns_yr11_nutrient <- data.table(read_sav("UKDA-6533-spss/spss/spss25/ndns_yr11_nutrientdatabank_2021-03-19.sav"))

 ndns1_4a_foodleveldietarydata_uk_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_foodleveldietarydata_uk_v2.sav"))

ndns5_6a_foodleveldietarydata_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_foodleveldietarydata_v2.sav"))
 
ndns7_8a_foodleveldietarydata_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_foodleveldietarydata.sav"))



 ndns_rp_yr9a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr9a_foodleveldietarydata_uk_20210831.sav"))
 ndns_rp_yr10a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr10a_foodleveldietarydata_uk_20210831.sav"))
 ndns_rp_yr11a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr11a_foodleveldietarydata_uk_20210831.sav") )
```

```{r processfooddataintotables, message=FALSE, warning=FALSE, include=FALSE}
#taking data from diet diary

UPFNOVA[,`Nova group`:= factor(`Nova group`,levels = 1:4)]
UPFNOVA$SubFoodGroupCode <- UPFNOVA$`food group number`

#specifically coded food groups

#combine with key for Nova Group
#first 1-4
foodlevedat4s <- ndns1_4a_foodleveldietarydata_uk_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
#foodlevedat4s[ ,seriali  := factor(seriali)]
foodlevedat4s<- foodlevedat4s[UPFNOVA, on= "SubFoodGroupCode"]
#summary(foodlevedat4s)

foodlevedat4s<- foodlevedat4s[,c("seriali","TotalGrams","Nova group","EnergykJ")]

#years 5-6
foodlevedat6s <- ndns5_6a_foodleveldietarydata_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat8s <- ndns7_8a_foodleveldietarydata_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat6s<- foodlevedat6s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat8s<- foodlevedat8s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat6s<- foodlevedat6s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat8s<- foodlevedat8s[,c("seriali","TotalGrams","Nova group","EnergykJ")]


#finally years 9, 10, 11
foodlevedat9s <- ndns_rp_yr9a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat10s <- ndns_rp_yr10a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat11s <- ndns_rp_yr11a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]

#combine with key for Nova Group

foodlevedat9s<- foodlevedat9s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat10s<- foodlevedat10s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat11s<- foodlevedat11s[UPFNOVA, on= "SubFoodGroupCode"]



foodlevedat9s<- foodlevedat9s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat10s<- foodlevedat10s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat11s<- foodlevedat11s[,c("seriali","TotalGrams","Nova group","EnergykJ")]

```

```{r functiondefn, message=FALSE, warning=FALSE, include=FALSE}
#To work out the gram weight amount of food intake by each individual, first the diary entries for each individual are totalled up.
#The total gram weight value of intake of each food is then worked out as a percentage of the total intake.



## First I write the function to process the individual entries. This totals the intake in grams and identifies the proportion by nova type.



IndividDiet <- function(DT,individ) {
  pers <- DT[seriali==individ]
pers
oneweight<-pers[, round(sum(TotalGrams),2), by=`Nova group`][order(`Nova group`)]

setnames( oneweight, 'V1','Totalg')
 oneweight[,pcnt := round((Totalg/sum(Totalg)*100),2)]

  return(na.exclude(oneweight))
}


```

```{r year9process, message=FALSE, warning=FALSE, include=FALSE}
#All these individual calculations are then built back up into tables.
#This is done for years 9-11 and then 1-4.

### This section uses the function designed above to process the table
name <-foodlevedat9s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat9s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat9sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat9sp



```

```{r year10process, warning=FALSE, include=FALSE}

name <-foodlevedat10s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat10s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat10sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat10sp


```

```{r year11process, message=FALSE, warning=FALSE, include=FALSE}

name <-foodlevedat11s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat11s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat11sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat11sp

#then combining the outputs 9-11
foodleveldat910sp <- rbind(foodleveldat9sp,foodleveldat10sp)
foodleveldat911sp <- rbind(foodleveldat11sp, foodleveldat910sp)
```

```{r year56process, warning=FALSE, include=FALSE}

name <-foodlevedat6s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat6s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat6sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat6sp


```

```{r year78process, warning=FALSE, include=FALSE}

name <-foodlevedat8s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat8s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat8sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat8sp


```

```{r slowprocessingfouryears, echo=FALSE, warning=FALSE,cache=TRUE}

name <-foodlevedat4s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat4s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat4sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat4sp



```

```{r energyfunctiondefn, message=FALSE, warning=FALSE, include=FALSE}
#The process can be done for food level energy intake also.

## First I write the function to process the individual entries. This totals the intake in grams and identifies the proportion by nova type.



IndividDietE <- function(DT,individ) {
  pers <- DT[seriali==individ]
pers
oneweight<-pers[, round(sum(EnergykJ),2), by=`Nova group`][order(`Nova group`)]

setnames( oneweight, 'V1','EnergykJ')
 oneweight[,Epcnt := round((EnergykJ/sum(EnergykJ)*100),2)]

  return(na.exclude(oneweight))
}


```

```{r Eyear9process, message=FALSE, warning=FALSE, include=FALSE,cache=TRUE}
### This section uses the function designed above to process the table
name <-foodlevedat9s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat9s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat9spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat9spE



```

```{r Eyear10process, message=FALSE, warning=FALSE, include=FALSE,cache=TRUE}
### This section uses the function designed above to process the table
name <-foodlevedat10s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat10s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat10spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat10spE



```

```{r Eyear11process, message=FALSE, warning=FALSE, include=FALSE,cache=TRUE}
### This section uses the function designed above to process the table
name <-foodlevedat11s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat11s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat11spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
foodleveldat11spE


#then combining the outputs 9-11
foodleveldat910spE <- rbind(foodleveldat9spE,foodleveldat10spE)
foodleveldat911spE <- rbind(foodleveldat11spE, foodleveldat910spE)
```

```{r Eslowprocessingfouryears, echo=FALSE, warning=FALSE,cache=TRUE}

name <-foodlevedat4s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat4s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat4spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat4spE



```

```{r E8processingfouryears, echo=FALSE, warning=FALSE}

name <-foodlevedat8s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat8s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat8spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat4spE



```

```{r E6processingfouryears, echo=FALSE, warning=FALSE}

name <-foodlevedat6s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat6s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat6spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat6spE



```

```{r addingtoearlierdata2, echo=FALSE, message=FALSE, warning=FALSE}

# combine with data from version10a.rmd

#sav11rpb <- readRDS("sav11rp.rds")


setkey(foodleveldat911sp, seriali)
setkey(foodleveldat911spE, seriali)

foodleveldat911spE <-foodleveldat911spE[foodleveldat911sp, by= seriali]
#sav11rp <-sav11rp[foodleveldat911spE, by= seriali]
#sav11rp$ED <- sav11rp[,.("Epcnt_4"/"pcnt_4")]

#sav4rp <- readRDS("sav4rp.rds")

#setkey(sav4rp,seriali)
setkey(foodleveldat4sp,seriali)
setkey(foodleveldat4spE,seriali)
foodleveldat4spE<-foodleveldat4spE[foodleveldat4sp, by= seriali]
#sav4rp <-sav4rp[foodleveldat4spE, by= seriali]


#setkey(sav6rp,seriali)
setkey(foodleveldat6sp,seriali)
setkey(foodleveldat6spE,seriali)
foodleveldat6spE <-foodleveldat6spE[foodleveldat6sp, by= seriali]
#sav6rp <-sav6rp[foodleveldat6spE, by= seriali]



#setkey(sav8rp,seriali)
setkey(foodleveldat8sp,seriali)
setkey(foodleveldat8spE,seriali)
foodleveldat8spE <-foodleveldat8spE[foodleveldat8sp, by= seriali]
#sav8rp <-sav8rp[foodleveldat8spE, by= seriali]

ndns_1_11food <- rbindlist(list(foodleveldat8spE,foodleveldat4spE,foodleveldat6spE,foodleveldat911spE))
```

```{r addingtoearlierdata, echo=FALSE, message=FALSE, warning=FALSE}
# combine with data from version10a.rmd
setkey(ndns_1_11food, seriali)
setkey(ndns_1_11, seriali)
ndns_1_11 <- ndns_1_11[ndns_1_11food, by= seriali]
```

```{r newvariables, echo=FALSE,message=FALSE}
#epcnt_4 divided into tertiles as cat variable
ndns_1_11$UPF <-  ndns_1_11$Epcnt_4 
                      
ndns_1_11$UPF3 <-  cut(ndns_1_11$Epcnt_4 ,
                       breaks=c(0, 33, 45,63,80,100))
ndns_1_11$UPF2 <- cut(ndns_1_11$Epcnt_4 ,
                       breaks=c(0, 63,100))
ndns_1_11$zPF <-  ndns_1_11$NOVA_Epct_opti_4
                      
ndns_1_11$zPF3 <-  cut(ndns_1_11$NOVA_Epct_opti_4 ,
                       breaks=c(0, 33, 45,63,80,100))
ndns_1_11$zPF2 <- cut(ndns_1_11$NOVA_Epct_opti_4 ,
                       breaks=c(0, 63,100))

ndns_1_11$SYear <- as.numeric(ndns_1_11$SurveyYear)
ndns_1_11$ngor <- as.numeric(ndns_1_11$gor)

ndns_1_11$agegad3 <-  cut(ndns_1_11$age ,
                       breaks=c(0, 16,19,35,50,65,108))
ndns_1_11$hyp <- cut(ndns_1_11$omsysval ,
                       breaks=c(0,140,300))
ndns_1_11$BP <- ndns_1_11$omsysval 
ndns_1_11$Na <- ndns_1_11$Sodiummg
ndns_1_11$hiNa <- cut(ndns_1_11$Sodiummg , breaks = c(0,1500,3000,5000,6000,10000))
ndns_1_11$hiNa2 <- cut(ndns_1_11$Sodiummg , breaks = c(0,5000,10000))
ndns_1_11$BMI <- cut(ndns_1_11$bmival ,breaks = c(0,18,24,30,50))
```

```{r imd, echo=FALSE, message=FALSE, warning=FALSE}
#ndns_1_11$IMD <- na.omit(ndns_1_11[,c(,WIMD_2014_quintile,SIMD_2016_quintile,NIMD_2017_quintile)])
ndns_1_11 <- ndns_1_11[,IMD:=EIMD_2015_quintile]
ndns_1_11 <- ndns_1_11[is.na(IMD),IMD:=WIMD_2014_quintile]
ndns_1_11 <- ndns_1_11[is.na(IMD),IMD:=NIMD_2017_quintile]
ndns_1_11 <- ndns_1_11[is.na(IMD),IMD:=SIMD_2016_quintile] 
#ndns_1_11$IMD

```

```{r takinganymeds, echo=FALSE, message=FALSE, warning=FALSE,include=FALSE}


ndns_1_11$bpd <- if_else(ndns_1_11$diur2=="Taking drug", "Taking drug" ,
                  if_else(ndns_1_11$beta2=="Taking drug", "Taking drug",
                         if_else(ndns_1_11$obpdrug2=="Taking drug", "Taking drug", 
                                if_else(ndns_1_11$calciumb2=="Taking drug", "Taking drug", 
                                       if_else(ndns_1_11$calciumb2=="Taking drug", "Taking drug","not taking drug"), missing = "not taking drug"), missing = "not taking drug"), missing = "not taking drug"), missing = "not taking drug")
head(ndns_1_11$bpd)
```

```{r surveydesign,message=FALSE, warning=FALSE, include=FALSE}

ndns_1_11d <- svydesign(ids = ~area, weights = ~ wti_UKY1to11, strata=~astrata1, data = ndns_1_11, nest = TRUE)

#Exclusions
#medication affecting bp
ndns_1_11dd <- subset(ndns_1_11d, bpd == "not taking drug")
ndns_1_11f <- subset(ndns_1_11dd, Sex == "Female")
ndns_1_11na <- subset(ndns_1_11dd, Na >= 5000)
ndns_1_11upf<- subset(ndns_1_11dd, UPF >= 63)
ndns_1_11zpf<- subset(ndns_1_11dd, NOVA_Epct_opti_4 >= 63)
ndns_1_11hyp <- subset(ndns_1_11dd, BP >= 140)
#ndns_1_11bp <- subset(ndns_1_11d, omsysval== is.na(NA))
#ndns_1_11bp

```

\newpage

# Results

## Participants

NDNS identified a 9990 addresses 2008-2011 for the first 3 years of the programme.
Either one adult and one child, or one child only were included.
The response rate was 55% in year one for completion of a food diary.
By 2019, 3466 completed food diaries of four days.
Subsequent years had different response rates, but within a similar scale allowing weighting to be used to balance the samples.

Considering participants who opted in and completed questionnaires, the whole NDNS population was 15,655.
The median age was 40.
Categorising age shows that 22% of the population was between 19 and 35.
There were 49% male participants.

After excluding those on medication, the population was 14217 participants.

This table [table 4.1.1](tab:table3) shows the participants.

Continuous variables are represented by the median and interquartile range in brackets.
Categorical variables give the number of participants and the percentage of the sample in brackets.

```{r table3, echo=FALSE, message=FALSE, warning=FALSE, cache=TRUE, paged.print=TRUE}
#| tab.id: "table3"
#| tbl-cap: "Characteristics of the sample population from National Dietary and Nutrition Study (2008-2019)"


keydatw1 <-tbl_svysummary(ndns_1_11d, include= c(Sex,Age, agegad3,   educfinh, IMD,gor,SurveyYear ))
#keydatw1
keydatwdd <-tbl_svysummary(ndns_1_11dd, include= c(Sex,Age, agegad3, educfinh, IMD,gor,SurveyYear ) )

keydatwzpf <-tbl_svysummary(ndns_1_11zpf, include= c(Sex,Age, agegad3,  educfinh, IMD,gor,SurveyYear) )
keydatwna <-tbl_svysummary(ndns_1_11na, include= c(Sex,Age, agegad3,   educfinh, IMD,gor,SurveyYear ) )
keydatwhyp <-tbl_svysummary(ndns_1_11hyp, include= c(Sex,Age, agegad3,    educfinh, IMD,gor,SurveyYear) )

keydatwT <- tbl_merge(list(keydatw1,keydatwdd,keydatwzpf,keydatwna,keydatwhyp),tab_spanner = c("Whole Population", "Population with those on BP medication excluded","UPF >63%","Na >5000mg","hyp >140mmHg"))
table3 <- as_flex_table( keydatwT)
table3 <- set_caption(table3, "Characteristics of the sample population from National Dietary and Nutrition Study (2008-2019) ", 
  autonum = run_autonum(seq_id = "tab", bkm = "tab3"))
table3

#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/table1.png")
#save_as_image(width(autofit(keydatflx), width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/table1.png")
#save_as_docx(width(autofit(table3), width=5), path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/table1.docx")
#heatmap(keydataw1)
```

## Descriptive Data

The study population the median age was 38.
The largest age group was 19-35.
49% of the participants were male.

Internal consistency was examined by comparing background data across survey years.
General linear regression modelling was used, with wave 1 as a comparator for analysis of the other waves.
Age was a variable which the whole sample was weighted to be maintained across the waves.
BMI was lower in most years but this was statistically significant only in wave 7 and 8.

[Table 4.2.2](tab:tbl-Key-Variables-by-Survey-year) shows results for continuous variables.

```{r tblVariablesbySurveyyear, echo=FALSE}
#| tab-id: "tbl-Key-Variables-by-Survey-year"
#| tbl-cap: "data quality continuous"

#ttestNa2 <- svyglm(Na~SurveyYear, ndns_1_11dd )
#ttestNa2t <- add_global_p(tbl_regression(ttestNa2))
#ttestEpcnt <- svyglm(NOVA_Epct_opti_4~SurveyYear, ndns_1_11dd )
#ttestEpcntt <- add_global_p(tbl_regression(ttestEpcnt))
#ttestOS <- svyglm(BP~SurveyYear, ndns_1_11dd)
#ttestOSt <- add_global_p(tbl_regression(ttestOS))
ttestage <- svyglm(Age ~ SurveyYear, ndns_1_11dd)
ttestages<-  add_global_p(tbl_regression(ttestage))
ttestbmi <- svyglm(bmival~SurveyYear, ndns_1_11dd)
ttestbmis <- add_global_p(tbl_regression(ttestbmi))
kvsearchyr <- as_flex_table(tbl_stack(list(ttestages,ttestbmis),group_header =  c("Age","BMI")))

kvsearchyr <- set_caption(kvsearchyr, "p.values for correlation of Continuous variables and survey year from National Dietary and Nutrition Study (2008-2019) ", autonum = run_autonum(seq_id = "tab", bkm = "tab4"))
kvsearchyr

#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/tbl-Variables-by-Survey-year.png")
#save_as_image(width(autofit(kvsearchyr), width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tbl-Variables-by-Survey-year.png")
#save_as_docx(width(autofit(kvsearchyr), width=5), path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tbl-Variables-by-Survey-year.docx")
```

The categorical data also had p.values \>0.05 for the controlled variables (age, sex, IMD) against annual wave.
UK region is part of the weighting, but this sample showed variation with p.value \<0.05.

Vegetarian had a p.value of \<0.05.
BMI had a p.value of 0.77.

[Table 4.2.3](tab:tbl-Categorical-variables-year) follows.

```{r multinomialregression,echo=FALSE,include=FALSE,warning=FALSE}
#library(svyVGAM)
#sexy <- svy_vglm(Sex ~SurveyYear , family=multinomial(refLevel=2), design=ndns_1_11d)
#sexy
#eduy <-svy_vglm(educfinh~SurveyYear , family=multinomial(refLevel=1),design= ndns_1_11d)
#eduy
#imdy <- svy_vglm(~EIMD_2010_quintile+SurveyYear ,family=multinomial(refLevel=1),design= ndns_1_11d)
#vegy <- svy_vglm(~vegetarn+ SurveyYear ,family=multinomial(refLevel=1),design= ndns_1_11d)
#UPF3y <- svy_vglm(UPF3~ SurveyYear , family=multinomial(refLevel=1), design= ndns_1_11d)
#UPF3y
#agegad3y <- svy_vglm(~agegad3+ SurveyYear ,family=multinomial(refLevel=1),design= ndns_1_11d)
#hypy <- svy_vglm(hyp~SurveyYear , family=multinomial(refLevel=2), design=ndns_1_11d)
#hypy
```

```{r tblCategoricalvariablesyear, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-Categorical-variables-year"
#| tbl-cap: "Key categorical variables by survey year from NDNS 2008-2018"

sexchi <- svychisq(~Sex +SurveyYear , ndns_1_11dd)
educhi <- svychisq(~educfinh+SurveyYear , ndns_1_11dd[,"SurveyYear" !=5])
imdchi <- svychisq(~IMD+SurveyYear , ndns_1_11dd)
vegchi <- svychisq(~vegetarn+ SurveyYear , ndns_1_11dd)
UPF3chi <- svychisq(~zPF3+ SurveyYear , ndns_1_11dd)
agegad3chi <- svychisq(~agegad3+ SurveyYear , ndns_1_11dd)
hypchi <- svychisq(~hyp+ SurveyYear , ndns_1_11dd)
BMIchi <- svychisq(~BMI+ SurveyYear, ndns_1_11dd)
gorchi <- svychisq(~gor+ SurveyYear, ndns_1_11dd)
tablecat<- data.table("Variable"=c( "Sex", "IMD","Age","BMI","Region","Vegetarian"),"ChiSq"=c(sexchi$statistic,imdchi$statistic,agegad3chi$statistic,BMIchi$statistic,gorchi$statistic,vegchi$statistic ),"p.value"= c(sexchi$p.value,imdchi$p.value,agegad3chi$p.value,BMIchi$p.value,gorchi$p.value ,vegchi$p.value))
tablecat <- flextable(tablecat)
tablecat <- colformat_double(tablecat, digits = 2)

tablecat <- footnote( tablecat, i = 1, j = 2,
            value = as_paragraph(c("Chi Squared for categorical data")),
            ref_symbols = c("1"),
            part = "header")
#tablecat <- footnote( tablecat, i = 4, j = 1,
#            value = as_paragraph(c("year 5 data missing")),
#            ref_symbols = c("2"))
#tablecat <- footnote( tablecat, i = 6, j = 1,
 #           value = as_paragraph(c("year 11 data missing")),
 #           ref_symbols = c("3"))
tablecat <- valign(tablecat, valign = "bottom", part = "header")
tablecat <- autofit(tablecat)
tablecat <- set_caption(tablecat, "p.values for correlation of categorical variables and survey year from National Dietary and Nutrition Study (2008-2019) ", autonum = run_autonum(seq_id = "tab", bkm = "tab5"))
tablecat
#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/tablecat.png")
#save_as_image(width(autofit(tablecat), width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tablecat.png")
#save_as_docx(width(autofit(tablecat), width=5), path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tablecat.docx")
```

The [table 4.1.1](tab:table3) shows the population exposed to UPF \>63% of their calories is made up of 4793 from a total of 14217 participants.
This compares with 9424 participants with lower exposure.
That is an exposure prevalence of 34%.

High UPF is more common in younger males than in the overall population or those not on medication.
37% are 0-16 years old.
There is a gradient in deprivation with more exposure in the most deprived group.
England's South East has 13% of those with high UPF intake.
With 11% in the North West.

The population exposed to Na \>5000mg has only 73 out of 14217 participants.
An exposure frequency of 0.5%.

Younger men are more commonly affected, 61% are 19-35.
The least deprived makes up 5.2% of the participants compared with 39% of the most deprived.
The north west has 23% of those with high Na intake, much the highest.

The exposure variables were compared across annual waves in [Table 4.3.1](tab:tbl-keydata) .
Most people have Na exposure less than 3000mg.
In year one this was 81%, with only 0.9% exposed to more than 5000mg.
By year eleven 92% are reporting less than 3000mg, and 0.5% over 500mg.

UPF exposure was steady with 37%-40% of the participants exposed to 45%-63% throughout the survey.
Up to 38.2% of the participants were exposed to levels of more than 63%, the peak being in year 6.

```{r tblkeydata, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-keydata"
#| tbl-cap: "Exposure by survey year from National Dietary and Nutrition Study (2008-2019) "

keydatw <-tbl_svysummary(ndns_1_11dd,by =SurveyYear , include = c(hiNa,zPF3))
keydatw <- add_p(keydatw)
tblkeydata <-as_flex_table( keydatw)
tblkeydata <- set_caption(tblkeydata, "Exposure by survey year from National Dietary and Nutrition Study (2008-2019) ", autonum = run_autonum(seq_id = "tab", bkm = "tab6"))
tblkeydata

#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/tblkeydata.png")
#save_as_image(width(tblkeydata, width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tblkeydatab.png")
#save_as_docx(width(tblkeydata, width=5), path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tblkeydata.docx")

```

Results were illustrated by plots against survey year.
[figure 4](fig:fig-upf-and-survey-year) showed overlap between the waves for UPF intake.
[figure 5](fig:fig-Na-and-survey-year) showed Na exposure overlap between waves.

```{r figupfandsurveyyear, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-upf-and-survey-year"
#| fig-cap: "Energy from UPF% in each annual cohorts NDNS (2008-2019)"


svyboxplot(zPF~SurveyYear,ndns_1_11dd, na.rm = TRUE,main = "UPF% by survey year", ylab = "UPF%" ,xlab ="Survey Year")
```

```{r figNaandsurveyyear, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-Na-and-survey-year"
#| fig-cap: "Na in mg in each annual cohort NDNS(2008-2019)"
svyboxplot(Na~SurveyYear,ndns_1_11dd,main = "Sodium Intake in mg by survey year", ylab = "Sodium intake in mg" ,xlab ="Survey Year")

```

## Outcome variable

```{r figBPandsurveyyear, echo=FALSE, message=FALSE, warning=FALSE}
#| fig-id: "fig-BP-and-survey-year"
#| fig-cap: "Plot of the BP in mmHg by year from NDNS (2008-2018)"

svyplot(BP~SurveyYear,ndns_1_11dd, na.rm = TRUE,main = "BP in mmHg by survey year", ylab = "BP in mmHg" ,xlab ="Survey Year")
```

[figure 6](fig:fig-BP-and-survey-year) identified the lack of data for year 11.

The [table 4.1.1](tab:table3) shows the population with BP \> 140 mmHg is 876 participants.
This gives a prevalence of 6%.

Men are once again overrepresented.
These participants are older than the population median, 44% of theses participants are over 65.
This group are statistically significantly different from the populations with high Na, or high UPF!
There is a reverse gradient with IMD in this population.
The most deprived are least represented in this population.
The largest proportion are in the least deprived category.
The north west is second highest in raised BP after the south east.
The BP was highest in year one with 125 mmHg, and the lowest 120 mmHg in year 6.
BP rose through life to a mean of 134 mm Hg in the over 65 age category.

```{r tblbpdata, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-bpdata"
#| tbl-cap: "BP by survey year from National Dietary and Nutrition Study (2008-2019) "

tblbpdata <-tbl_svysummary(ndns_1_11dd,by =SurveyYear ,include = c(hyp))
tblbpdata <- add_p(tblbpdata)
tblbpdata <-as_flex_table( tblbpdata)
tblbpdata <- set_caption(tblbpdata, "BP by survey year from National Dietary and Nutrition Study (2008-2019) ", autonum = run_autonum(seq_id = "tab", bkm = "tab7"))
tblbpdata

#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/tblkeydata.png")
#save_as_image(width(tblkeydata, width=5), "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tblkeydatab.png")
#save_as_docx(width(tblkeydata, width=5), path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/tblkeydata.docx")

```

## Main Results

The main results are the correlation between the exposure and the outcome variables.
These are presented using 2\*2 tables with no additional control for confounding.
Univariable regression demonstrated the interaction with other explanatory variables.
This is complicated by the effect of stratification.

Chi squared table The odds ratio for hypertension in participants exposed to UPF \>63% is 0.5.
The odds ratio for hypertension in participants exposed to Na \>5000mg is 1.45

```{r chisq, echo=FALSE, message=FALSE, warning=FALSE}
hyp1chi <- svychisq(~hyp+ hiNa2 , ndns_1_11dd, na.rm=TRUE)
hyp1chi$p.value
round(ftable(hyp1chi$observed),2)


hyp2chi <- svychisq(~hyp+ zPF2, ndns_1_11dd, na.rm=TRUE)
hyp2chi$p.value
round(ftable(hyp2chi$observed),2)
```

```{r tblunivariableregressionsb, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-univariable-regressionsb"
#| tbl-cap: "regressions in pairs between key variables full population showing direction and strength of relationships NDNS data 2008-2019"
#univariable regression models
#UPF Energy % only
lm1E <- svyglm(BP ~ zPF, ndns_1_11dd)
lm1Et <- tbl_regression(lm1E)
#univariable regression models
#sodium only
lm1na <- svyglm(BP ~ Na, ndns_1_11dd)
lm1nat <- tbl_regression(lm1na)

lmEna <- svyglm(zPF ~ Na, ndns_1_11dd)
lmEnat <- tbl_regression(lmEna)

lmA <- svyglm(BP ~ Age, ndns_1_11dd)
lmAt <- tbl_regression(lmA)

lmEA <- svyglm( Age ~ zPF, ndns_1_11dd)
lmEAt <- tbl_regression(lmEA)

lmNaA <- svyglm(Na ~ Age, ndns_1_11dd)
lmNaAt <- tbl_regression(lmNaA)

#row1<- tbl_merge(list(lm1nat,lm1Et,lmEnat),tab_spanner = c("BP","UPF","Na"))
#row2 <- tbl_merge(list(lmAt,lmEAt,lmNaAt),tab_spanner = c("BP","UPF","Na"))
#as_flex_table(tbl_stack(list(lm1nat,lmEnat,lm1Et,lmEAt,lmAt,lmNaAt),group_header = c("BP/Na","UPF/Na","UPF/bp","UPF/Age","Age/BP","Age/Na")))
```

The regression model for Sodium against BP shows that there is no linear relationship between Sodium and BP in this table [Table 4.4.1](tab:tbl-univariable-regressions).
UPF compared to Na also shows a zero beta value indicating no linear relationship.

UPF does show a negative relationship with age, which is statistically significant.
There is also a negative relationship with Age, again statistically significant.

Age has a relationship with BP with a statistically significant positive gradient.
There is also a positive relationship with Na, which is also statistically significant to the 95% level.

```{r tblunivariableregressions, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-more-univariable-regressions"
#| tbl-cap: "Table of Regressions of BP, Na and UPF against Age, bmi, educfinh full population NDNS data 2008-2019"
#univariable regression models
#UPF Energy % only
lm1bmi <- svyglm(BP ~ bmival, ndns_1_11dd)
lm1bmit <- tbl_regression(lm1bmi)
#univariable regression models
#sodium only
lm1Ag1 <- svyglm(BP ~ agegad3, ndns_1_11dd)
lm1Ag1t <- tbl_regression(lm1Ag1)

lmEbmi <- svyglm(zPF ~ bmival, ndns_1_11dd)
lmEbmit <- tbl_regression(lmEbmi)

lmed <- svyglm(BP ~ educfinh, ndns_1_11dd)
lmedt <- tbl_regression(lmed)

lmEs <- svyglm(zPF ~ agegad3, ndns_1_11dd)
lmEst <- tbl_regression(lmEs)

lmEed <- svyglm(zPF ~ educfinh, ndns_1_11dd)
lmEedt <- tbl_regression(lmEed)

lmNabm <- svyglm(Na ~ bmival, ndns_1_11dd)
lmNabmt <- tbl_regression(lmNabm)

lmNaed <- svyglm(Na ~ educfinh, ndns_1_11dd)
lmNaedt <- tbl_regression(lmNaed)

lmNaAg <- svyglm(Na ~ agegad3, ndns_1_11dd)
lmNaAgt <- tbl_regression(lmNaAg)

#row1<- tbl_merge(list(lm1nat,lm1Et,lmEnat),tab_spanner = c("BP","UPF","Na"))
#row2 <- tbl_merge(list(lmAt,lmEAt,lmNaAt),tab_spanner = c("BP","UPF","Na"))
univariables <- as_flex_table(tbl_stack(list(lm1nat,lmEnat,lm1Et,lmEAt,lmAt,lmNaAt,lm1bmit,lm1Ag1t,lmedt,lmEbmit,lmEst,lmEedt,lmNabmt,lmNaAgt,lmNaedt),group_header = c("BP/Na","UPF/Na","UPF/bp","UPF/Age","Age/BP","Age/Na","BP/bmi","BP/Agg1","BP/ed","UPF/bmi","UPF/age","UPF/ed","Na/bmi","Na/Agg","Na/ed")))
univariables<- set_caption(univariables, "Table of Regressions of BP, Na and UPF against Age, bmi, educfinh full population NDNS data 2008-2019", autonum = run_autonum(seq_id = "tab", bkm = "tab8"))
univariables
#png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/univariables.png")
#save_as_image(univariables, width=5, "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/univariables.png")
#save_as_docx(univariables, width=5, path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/univariables.docx")
```

Multivariable regression models were constructed based on the outcomes of the univariable regression identifying relevant additional variables.

The selected models regressed against (hyp) a variable identifying hypertension as 140mmHg in patients who are not on BP reducing medication.

The model, "Sodium Only", adds sodium as the exposure variable.
The odds ratio for the group taking between 5000mg and 6000mg per day is statistically significantly different from those taking less than 3000mg per day.
There is an odds ratio of 5.07 for this group.

"UPF only" shows a significant difference in odds ratio 0.61 for the group 63-80% with a p.value of 0.049.

The last model, "Sodium and UPF", shows that when combined the effect remains.
The odds ratio for 5000-6000mg of Na remains statistically significant.
The odds ratio for UPF also remains.

[Table 4.5.1](tab:tbl-multivariable-outputs-bp) follows below.

```{r bpmultivariablemodels, echo=FALSE, warning=FALSE}

lm1AS <- svyglm(hyp ~  Sex +BMI +agegad3+educfinh + IMD +SurveyYear,family = binomial(link = "logit"), ndns_1_11dd , na.action = na.exclude)

theme_gtsummary_mean_sd()

#sodium only
lmna <- svyglm( hyp ~ hiNa  +Sex +agegad3 + BMI+educfinh+  IMD+SurveyYear ,family = binomial(link = "logit"), ndns_1_11dd,na.action = na.exclude)

lmnaE <- svyglm(hyp ~ hiNa +Sex +agegad3+ zPF3 + BMI +educfinh+ IMD +SurveyYear,family = binomial(link = "logit"), ndns_1_11dd,na.action = na.exclude)

lmME <- svyglm( hyp~ zPF3 +agegad3+Sex + BMI +educfinh + IMD +SurveyYear,family = binomial(link = "logit"), ndns_1_11dd,na.action =na.exclude)

#lmME2 <- svy_vglm(UPF3 ~ hyp+hiNa +agegad3+Sex + bmival +educfinh + EIMD_2010_quintile +bpd,family = multinomial(refLevel=1),design= ndns_1_11d,na.action =na.exclude)
#tbl_regression(lmME2)

```

```{r tblmultivariableoutputsbp, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-multivariable-outputs-bp"
#| tbl-cap: "Table of multivariable regression against BP to identify the effects relating to Na and UPF NDNS data 2008-2019"
#lm1ASt <-tbl_regression(lm1AS,include=c(hiNa,NOVA_Epct_opti_4) ,exponentiate = TRUE)
lmnat <- tbl_regression(lmna,include=hiNa,exponentiate = TRUE, label = list( hiNa ~ "Sodium Intake in mg"))
lmnaEt <- tbl_regression(lmnaE,include=c(hiNa,zPF3),exponentiate = TRUE, label = list(zPF3 ~ "percent Ultraprocessed Food", hiNa ~ "Sodium Intake in mg"))
lmMEt <- tbl_regression(lmME,include=zPF3,exponentiate = TRUE, label = list(zPF3 ~ "percent Ultraprocessed Food"))

multivariables<- set_caption(as_flex_table(  tbl_merge(list(lmnat,lmMEt,lmnaEt), tab_spanner = c("Na only","UPF only","Na and UPF")), caption = "Table of multivariable regression against BP to identify the effects relating to Na and UPF NDNS data 2008-2019", autonum = run_autonum(seq_id = "tab", bkm = "tab9")))
multivariables <- add_footer_lines(multivariables, "All models include additional variables Sex,Age, BMI, Education, IMD and Survey Year")

multivariables
# png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/multivariables.png")
#save_as_image(multivariables, width=5, "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/multivariablesb.png")
#save_as_docx(multivariables, width=5, path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/multivariables.docx")
```

Using the AIC statistic for each model gives another way of understanding the comparative effects.
The subsequent [Table 4.5.2](tbl-AIC-comparison) shows the size of the effect relating to sodium.
The lowest scored model is the optimal model.
The 'best' of these models is that with only sodium included "Na only".
The UPF models both being further away from the lowest value.

Of the difference between the lowest scoring model and the highest 80/20 is due to UPF

There is a significant sensitivity of the data set to improved modelling.
Though the set of models around the same values includes the four regressed against BP, and two of those against UPF which include BP.

```{r AICsense1, echo=FALSE, message=FALSE, warning=FALSE}

#AIC(lmM,lmMna,lmM2)
#sense1 <- (lm1AS2$aic - lmnaE3$aic)*100/lm1AS2$aic 
#sense1

sense2 <- (lmME$aic-lmna$aic)*100/(lmME$aic-lmna$aic)
sense2
sense3<- (lmME$aic-lmnaE$aic)*100/(lmME$aic-lmna$aic)
sense3

```

```{r tblAICcomparison, echo=FALSE, message=FALSE, warning=FALSE}
#| tab-id: "tbl-AIC-comparison"
#| tbl-cap: "Table of AIC NDNS data 2008-2019"

AICt<- data.table("Model"=c("No Na or UPF","Na only","UPF only","Na and UPF"),"AIC" =c(lm1AS$aic, lmna$aic,lmME$aic,lmnaE$aic))
AICt <- set_caption(as_flextable(AICt), "Table of AIC NDNS data 2008-2019", autonum = run_autonum(seq_id = "tab", bkm = "tab10"))
AICt

# png("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/AICt.png")
#save_as_image(flextable(AICt), width=5, "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/AICtb.png")
#save_as_docx(flextable(AICt), width=5, path = "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/AICt.docx")

```

\newpage

# Discussion

## Key Results

The chi squared test shows a statistically significant correlation between UPF and hypertension.
This simple model does not allow for confounding or additional variables to be taken into account.

The multivariable logistic regression controls a number of additional variables.
Sex and age probably contribute the largest affects.
These models show a statistically significant correlation between high Na intake and hypertension, and between high UPF and hypertension.
This is present with each variable independently and with both in the model.

## Limitations

### The study

This is a cross-sectional study, and so has the limitations of this design.
In particular the study measures exposure and outcome at the same time.
This makes interpretation of the direction of causation difficult.
This is particularly an issue here where participants aware of their BP might have chosen to reduce their UPF intake.

This study was organised by the government departments connected with food and farming alongside the Department of Health.
This means it was intended to monitor outcomes relevant to these departments.
The funding and commissioning processes might affect the structure of the study and might also affect participant engagement and expectation.
In particular this might affect social desirability bias.
Social desirability and other participant reporting bias may well be significant within dietary diaries.
Double labelled water studies on the first wave showed some significant differences between measured energy intake, and reported energy intake with differences between different age groups.

### The data

The result depends on participants recording foods in the same way as time goes on.
Exposure of the whole population to a stimulus to change their diet or the recording of their diet may result in systematic changes in results.

A uniform change in the nutrient content of the food or changing the nutritional definitions would affect results.
Years 9-11 used a slightly different methodology for identifying foods for analysis as researchers have started to become aware of the need to understand 'processing'.
This may account for the apparent lower exposure in the last three years.

These changes would affect the outcome variable less.
However BP measurement technology has changed over ten years.
BP machines derive their results from the changes in pressure detected in the arm of the participant, the algorithm used by the sphygmomanometer may have changed.

Weighting maintains age, sex, IMD, and government region across the waves.
BMI is no different, and educational attainment is also unaffected.
There are more vegetarians as time goes on.

The populations do change over time as some of the added variables do show statistical significant changes.
In particular the number of vegetarians increases, which perhaps is one indicator of social desirability affecting the study.

In populations with exclusions the careful sample selection and weighting are overcome by the biasing effect of different selections.
When this is on BP there is a change between cohort sex balance.
This is possibly as a result of changing/ increasing acceptance of BP results of all people whereas in earlier cohorts there were less women with raised BP levels.

This effect is perhaps greater when medication exclusions are made.
Treatment of women and younger men has increased over the 10 years of the study.

### The analysis

## Interpretation

Participants with high Na \>5000mg are more likely to have hypertension.
Causation from other studies is likely to be that this high Na intake is contributing to high BP.
However from this study causation cannot be identified.
Other possibilities are that raised BP stimulates ingestion of Na, that Na ingestion increases hypertension, or that people with hypertension share another characteristic that increases their Na intake.

The results around high UPF intake also do no more than imply correlation.
Causation might be the high BP reduces intake of UPF, or that participants with high BP are more aware of dietary UPF content.
This can affect the detected directionality of the correlation.

### Ideas for further research

I will divide these suggestions into quantitative and qualitative.

#### Quantitative

There is scope for more research based on this data set.
Within this same biomedical paradigm there are whole range of variables which can be compared against the clinical and biochemical outcomes.
These include measured variables such as BMI, biochemical indicators such as Hba1c and medical diagnostic categories such as Diabetes.

Modelling research has allowed projections to be made using the data from studies such as this as a base for projected models.
This can evaluate policy effects.

#### Mixed and Qualitative

The richness of the quantitative data in this survey calls for its use within an approach allowing more detailed description and in depth assessment with participants.
In the study data there are data allowing research around cooking activities, hobbies, and eating activities.

It could also be used as a template for studies smaller in geographical scope, but more in depth as cross over studies collecting both quantitative and qualitative data.

#### Ideas for policy

Policy is an 'upstream' approach.
It can be used to reduce exposure indirectly or directly.
Ideas include legislation to reduce UPF use, this might be by pricing, or other approaches.
Health promotion policy needs to match policy activity.
People who know that UPF is bad, are more likely to accept policy limiting availability.

Reformulation is a policy suggestion, where UPF is further processed to remove the salt.
This is frequently discussed.
By demonstrating that UPF is not just high in salt this study supports the argument of avoiding further formulation as a policy for reducing BP.

Dietary approaches to improving public health are able to deliver proportionate and universal interventions to populations to reduce the incidence of NCD.
When delivered up stream at the policy level they are effective and efficient and minimise cost.
These approaches offer significant benefits over actions targeted at individuals.

Dietary and 'awareness' approaches can be used by individuals.
These approaches risk the development of a culture of blame of individuals and of sub-groups in society.
The commercial and social determinants of health play out a significant role in research, and delivery of public health improvements around food.

This study aims to inform local policy to reduce BP and so Non-Communicable Disease.
If UPF and sodium intake increase the risk of hypertension then policy to reduce exposure might deliver change at a population level.

## Generalisability

This study used national data.
This was stratified across the four home nations.
It was stratified for IMD, and sex and to cover adults and children.
The study can therefore be generalised to the UK population.
The results are comparable with those in Korea, Brazil and USA.
These include countries with lower UPF intake, but also similar levels.

\newpage

# Conclusion

In summary the research question was In adults and children across the four home nations of the UK between 2008 and 2019, did exposure to high sodium dietary intake, and or high UPF dietary intake, compared to lower exposure, increase the odds of having a mean systolic blood pressure of over 140mmHg?

In answer, the odds ratio for hypertension is increased and statistically significant for high Na compared to lower exposure to Na.
The odds ratio for hypertension is statistically significant for high UPF, being lower compared to lower exposure to UPF.

The first finding matches the findings of other researchers in other countries and in past studies in the UK.
The second finding seems to be contrary to other studies.
Further research will be needed to understand this result.

Other objectives were also met with a literature review examining the research around Na and UPF and BP, and discussion of the interpretation and generalisability of the study.
I will present the findings to support policy development.

\newpage

# Bibliography

::: {#refs} :::

# Appendix {.unnumbered}

# Appendix 1 Approved Proposal

The approved proposal

# Appendix 2 Ethics Certificate

The ethics cert.

# Appendix 3 Software used

The software used

```{r packagecite, echo=FALSE, warnings=FALSE }
#cite_packages(output="citekeys", out.dir = getwd() ,out.format= "Rmd")

```
