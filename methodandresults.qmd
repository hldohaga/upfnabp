---
title: "bp upf and na"
output:
  html_notebook: 
    toc: yes
    fig_caption: yes
    number_sections: yes
  html_document:
    toc: yes
    fig_caption: yes
    number_sections: yes
    keep_md: yes
  word_document: 
    toc: yes
    fig_caption: yes
    keep_md: yes
    toc_depth: 4
  pdf_document: 
    toc: yes
    fig_caption: yes
    number_sections: yes
    keep_tex: yes
    latex_engine: xelatex
editor_options: 
  
  markdown: 
    
    wrap: sentence
  bibliography: references.bib
  
bibliography: references.bib
csl: Vancouver.csl
---

# Trends in the association between Ultra-processed foods, salt intake and Blood Pressure using the National Dietary and Nutritional Survey (NDNS) in England 2008-2019 {.unnumbered}

# David O'Hagan {.unnumbered}

200299857

## Dissertation submitted in partial fulfilment of the requirements for the degree of Master of Public Health, The University of Liverpool {.unnumbered}

## August 2023 {.unnumbered}

\newpage

## Dedication {.unnumbered}

To Julie Andrew and Sophie

\newpage

## Acknowledgments {.unnumbered}

To Zoe and Martin

To Paul

\newpage

# Abstract {.unnumbered}

The study showed that there is a correlation between UPF intake and BP, which disappears when Age is a covariable.
It also showed that sodium intake has no correlation with BP as an isolated variable, but that it is important within multivariable models.

The study shows a complex relationship between UPF intake and population risk of BP and CVD.
It also shows that reduction of the sodium content may be effective at reducing the overall risk.

This is a secondary data study the national dietary and nutrition survey @universityofcambridge2022 of looked at BP and the effects of UPF and Na.BP is clinical, and a proxy measure for CVD.

Policy should aim to reduce percentage intake of UPF and increase percentage intake of unprocessed foods.

```{=tex}
\tableofcontents
\listoffigures
\listoftables
\newpage
```
# Introduction
```{r library,include=FALSE}
library(haven)
library(data.table)
library(readxl)
#library(sensemakr)
library(labelled)
library(survey)
library(srvyr)
library(gtsummary)
library(stargazer)
library(knitr)
library(flextable)
library(officer)
library(dagitty)
library(grateful)
```
There is thought to be an association between blood pressure (BP) and intake of Ultra-processed Foods (UPF) and Salt intake.
This study looks at this association in the data set of the National dietary and nutrition survey (@universityofcambridge2022 ).The study gives data from 2008 to 2019.
There have been changes in the intake of UPF, of salt and BP over that time.This study will describe those changes.As part of this description, I will identify how BP is affected by these key dietary factors.
I will attempt to identify the role salt intake plays in the effect of ultraprocessed food on BP.

```{r dag1, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-dag
#| fig-cap: "DAG of relationships explored by analysis"

bp1 <- dagitty(" dag {
               Na -> BP
               Age -> BP
               Sex -> BP
               UPF -> BP
               UPF -> Na
               Age -> UPF
               Sex -> UPF
               BP -> NCD
               Age -> Na
}")
plot(graphLayout(bp1))

```

@fig-dag shows a possible arrangement of the relationships between UPF, Na and BP highlighting the onward relationship to non-contagious disease, and the underlying importance of age and sex. This paper will seek to explore this complex web by pulling out strands within it.

### Public Health Impact

Public Health intends to reduce the burden of ill health across the population.
BP is an indicator of the health of the population, in that it is a risk factor for a number of non-communicable diseases (NCD) @cappuccio2015 .

Dietary approaches to improving public health are able to deliver proportionate and universal interventions to populations to reduce the incidence of NCD.
These can be delivered up stream at the policy level.
This is effective and efficient and minimises cost.

Dietary approaches can also be used by individuals.
This approach risks the development of a culture of blame of individuals whose choices are limited by systems outside of their control.
The commercial and social determinants of health play out a significant role in research, and delivery of public health improvements around food @marmot2010 .

### Epistemology

The epistemological approach of this study is positivist.
I use a quantitative approach in a mechanistic and deterministic model.
However, I am aware that this model is an incomplete description of the whole of reality.
So that whilst I work within this positivist framework, I am aware that the model is limited by the isolation which defines the parameters of the study.

In particular I am aware that real world application to dietary change requires interaction with social and economic factors.
These factors are often much better understood within critical realist and social constructionist models.
The commercial and social determinants of health are both constructionist models which have a great deal of impact on the reality of dietary effects on BP and on the availability of UPF and on their nutritional constituents.

### Positionality

In a positivist paradigm the observer is external to the model.
Acknowledging that there are constructivist aspects to this study allows that the observer is closer to the model.
My positionality is therefore of interest to interpretation of the derived model, but also to understand reasons for decisions about the approach to the data.
I share with Jafar @jafar2018 an intention to lead in describing my positionality in this quantitative study.

I am from a biomedical background, which brings an attachment to positivist ideals.
However, as a practising physician I am aware of the interaction of any number of social factors on the health of participants as Evans and Trotter @evans discuss .
These impact on food 'choices', which might be determined by social expectations as much as by income, or geography.
They also impact on 'hard' clinical measurements such as BP.
This can be affected by position and room temperature as well as by the relationship between the observer and the participant.

This work is primarily to complete requirements for an MPH degree which means that it is influenced by factors around health equity and classic epidemiology as taught on the course.
It is produced in collaboration with a research group with a long established reputation in food research in public health, which may steer the results in a conservative direction.

Positivist 'grand isolation' may reduce the influence of these factors, but they remain as influences.

I accept that to proceed, whilst I need to be aware of the limitations of the positivist approach and the necessity of making pragmatic selections that there is some degree of validity to the resulting dataset.
Otherwise, analysis of it would be of no purpose.

## University Research Governance and Ethical Review 

The ethics process for the University of Liverpool was followed and a certificate of compliance is attached at appendix 2. 

The storage of the data is in keeping with the research governance agreements of the University and the Data set owners. 


## Research Question

What proportion of the association between blood pressure (SBP) and UPF intake can be explained by the changes in salt intake in England between 2008 and 2019?

The question can be split into parts, What was intake of salt between 2008 and 2019?
What was intake of UPF between 2008 and 2019?
What was BP between 2008 and 2019?
Did each of these change over that time and how?
Did the changes in any one affect any other?
What are the sizes of the changes?
Which element was most important in these changes?

All of these questions look for numbers as answers.

Answering the question starts with collecting a sample of participants.
Measurements are taken, and then collated.
The collected numbers are then compared in different ways to answer each part of the question.

##  Aims and Objectives

\newpage

# Literature Review

## Introduction

This section will describe the search strategy and techniques used to identify articles to make up the review.
Then there will be a review of separate sections of the literature, before developing a synthesis of the literature at present and explanation on how it relates to the research question.

## Search Strategy

The search strategy has a core systematic approach but is augmented with additional items from a range of sources.
The success of the search is that it identifies a wide variety of articles which help to outline and augment the argument developed.

My search aims to identify most of the related articles.
Starting with a broad search strategy, the results are narrowed identifying those of particular relevance, by reading abstracts and cross referencing with other papers.
Also, after discussion colleagues passed on further relevant literature.

In addition, I identify papers from the bibliographies of identified papers.
Reviews and meta-analyses are good at presenting search strategies and identifying high value studies.

These identify search terms not initially included.
Despite limiting the search to high blood pressure many of these searches consider broader clinical endpoints, using metabolic syndrome, diabetes and cerebrovascular and cardiovascular disease.

My search terms are included in the table below.
They were searched through a meta database which includes Medline, and Ovid and Scopus.
This meta database enables an ongoing search which is able to send messages about new articles as they are published.

| Search Terms Used                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |
|------------------------------------------------------------------------|
| "ultra-processed food" OR "ultra-processed foods" OR "ultraprocessed food" OR "ultraprocessed foods" OR "ultra-processed product" OR "ultra-processed products" OR "ultra-processing" OR "food processing" OR "processed food" OR "processed foods" OR "NOVA" OR "NOVA system" OR "NOVA food classification" OR "NOVA classification system") AND (hypertension OR "high blood pressure" OR "high blood pressures" OR "blood pressure" OR "systolic pressure" OR "diastolic pressure" OR "systolic blood pressure" OR "diastolic blood pressure") AND (adult OR adults OR aged OR "middle aged" OR elderly OR "older adult" |

Table 2.1: Table of search terms used

## Search results

This search produced 1328 results the search allowed medical, public health, nursing articles to be prioritised and engineering, chemical, and technology articles to be deprioritised.

There were no time limits, language limits or availability limits in the initial search.
These 1328 were reduced down by reading titles and abstracts to identify relevant articles.

Papers were excluded which related to technology including food technology.
They were also excluded if the primary purpose of the paper was unrelated to dietary or nutritional causes of clinical outcomes.

## Overview of literature

The literature has developed over some time.
The results arrange themselves therefore into several groups.
Firstly there are those which describe the development of the argument that salt relates to BP and so to NCD.
UPF is a recent phrase developed within the Nova framework which was described in 2009 so the arguments around UPF and its relation to BP and so NCD are more recent.
This later group build on the earlier work, but importantly they only superficially analyse the way that UPF and salt interact.

In addition papers may be categorised as primary research, systematic reviews with meta analysis, model analysis, and papers which use the other categories to consider public health policy approaches.

-   1 describe literature
-   2 synthesise literature
-   3 critique literature
-   4 explain role of study within context

### Na, BP, NCD and Public Health

```{r dagNa, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-dagNa
#| fig-cap: "DAG of relationships between BP and Salt"

bp2 <- dagitty(" dag {
               Na -> BP
               Age -> BP
               Sex -> BP
            
               BP -> NCD
               Age -> Na
}")
plot(graphLayout(bp2))
```

Non-communicable disease is an increasing burden on public health.
@cappuccio2015 layout the charges against salt most clearly.
They identify comprehensively the connection between changes in salt intake and changes in blood pressure and changes in cardiovascular (CVD) and cerebrovascular diseases.
They link the nutritional effect of salt but they also identify the way this is affected by social and commercial determinants of health.
These are branches from different epistemological backgrounds, nutrition from positivism, and the social determinants from a more constructivist approach.

@kannel2009 , @kannel1993, and @mahmood2014 describe how risk factor medicine came about.
They describe raised blood pressure as a 'prominent member' of a group of risks in cardiovascular disease.
A disease which is the outcome of 'multiple forces'.
Their description sees this as part of the march of progress in understanding cardiovascular disease in particular, but also non-communicable disease.
Kannel identifies that cardiologists alone cannot conquer cardiovascular disease.
Since then BP has come to feature more and more in NCD, following studies showing that reducing BP reduced the risk of CVD .
This placed Blood pressure detection, management, and control at the centre of reducing CVD ( @bress2021 , @DebonRaquel2020Eoua , @ettehad2016 , @pringle2003 , @roche2018 ).

The causes of BP, as Kannel explains, are divided into secondary BP where there is an identified pathological cause and 'essential' or idiopathic BP where no cause is identifiable.
Contributors to and partial causes of this essential BP have been sought, at individual and societal levels, using medical and epidemiological approaches ( @who , @bloodpr , @bloodpr2018 ).
Key factors are often separated into lifestyle causes ( @boutain2001 ), and social determinants( @colombet2022 , @colombet2019 , @ji2014 , @jones2018 , @healthy2017 , @macgregor2015 ).
Commerce also has a role to play in a causation model which embraces an understanding of causation on a population scale.

Salt is a contributor to the physiology of BP.
Its role in pathology is less clear.
There are increasing levels of intake.
This is correlated with increasing BP readings.
Other nutrients have also been correlated.
The role of salt in normal and abnormal BP control is established ( @cappuccio2015 , @intersal1988 , @elliott1996 , ).
However there remain areas of contention( @newman2017 ).
There may be individuals with higher sensitivity to salt ( @elijovich2016 ).
Understanding the best approaches to reducing salt is difficult.

Is it best to get individuals to reduce intake( @yourgui1998, @reports2023 , @vollmer2001 , @sacks2001 , @NilsonEduardoAugustoFernandes2021Eprd ), or for all of the food industry to reduce salt levels( @cappuccio2011 , @he2010 ).

#### Approach to change

Lifestyle factors are contented.
Whilst individual choice is involved.
The range of choices available to individuals is limited by the nature of their society.
A misapplication of lifestyle results in blaming individuals for the poor choices determined by their social and commercial environment. Iso @iso1999 looks at how education may be effective in delivering change.

Instead of trying to change activity of millions of people can be more effective to change laws and policies once ( @instituteofmedicine2010 , @laverty2019 , @millett2012 , @moreira2015 , @instituteofmedicine2013 ).
These 'upstream' changes are relatively simple, and are much more effective though they can also be reversed ( @cappuccio2015 ). Cost is one of the causes of change as shown by Jones @jones2018 using NDNS to identify the cost premium of a good diet as defined by UK dietary recommendation . 
Opposition sometimes comes from industry.

@laverty2019 and @macgregor2015 showed that an analytical model can effectively demonstrate the effects of different policies on population health.
They identify that reducing the effectiveness of a policy on salt in food leads to changes in BP and so on to NCD.

@campos-nonato2022 identify the benefits of their strategy.
They discuss the range of nation level approaches to reducing salt intake.


  

6.  National Food Strategy, editor.
    National Food Strategy: part one.
    $$Internet$$.
    London: National Food Strategy,; 2020.
    Available from: <https://www.nationalfoodstrategy.org/partone/>

### UPF and BP

```{r dagupf, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-dag-upf
#| fig-cap: "DAG of relationships of UPF"

bp3 <- dagitty(" dag {
             
               Age -> BP
               Sex -> BP
               UPF -> BP
              Age -> UPF
               Sex -> UPF
               BP -> NCD
              
}")
plot(graphLayout(bp3))
```

### UPF

Nova classification looks at food beyond the nutrient level.
It incorporates ideas relating to 'processing of food' But also includes availability and intake which are all affected.
Increasing Category four or UPF is associated with increasing BP.
Other approaches to food classification try to address more than the nutritional content.
There is always conflict between commercial interests and restriction to the freedom to exploitation

Food classification has traditionally concentrated on nutritional analysis eg Nutriscore ( @cuj2021 , @dickie2022, @romeroferreiro2021 , @A.Asma2019Fcsb ).
The social aspect of food has been studied famously by Bourdieu ( @bourdieu2002, @abourdi2021 ).
The effect of the social and commercial nature of food is partly accounted for in Monteiro's Nova classification.
Dickie et al( @dickie2023 , @dickie2022 ) tried to develop a system which took this idea further, but struggled to build a model which was any more effective.

Monteiro's initial explanation uses the concept of 'processing' ( @monteiro2009 , @monteiro2016 , @monteiro2010 , @monteiro2013 ).
In a recent debate @monteiro2022 and @astrup2022 discuss the concept of UPF and if it is valid or useful.
This idea separates foods into categories based on the amount of processing that occurs before the food is consumed.
Group one are foods which are in a natural state, as plucked from the tree.
Group two is foods which are used in processes to modify group one foods.
Group three initially was all other foods, but was soon separated into minimally processed foods, and group four the ultra-processed foods.

Explanations for the differential effect of these foods have developed as quickly as new ultra-processed foods have been developed .
Is it due to nutritional content( @aceves-martins2022 )?
They are high in salt and sugar on average.
Is it due to effects on satiety, or changes to appetite( @rauber2019 )?
Do they taste better @bawajeeh2021 ?
Is it due to being easy to buy, and easy to eat( @wang2021 )?
Is it because they don't require time and effort in the home to process?
Is it because these processes are industrial?
Is it because these foods contain 'chemicals' or new ingredients?
These explanations move from nutritional through into social and commercial.

All these critiques are possible because of the social element to the classification.
Colombaet @colombet2022 identify that the intake of UPF has an inequality dimension and then @ColombetZoé2021Dass use  modeling to describe a 'nutrition transition'.


Nutrition based classifications appear less socially divisive due to scientific isolation.
They still contain elements of social factors.
In particular, the way that foods are analysed can change their reported nutritional content.
Eg a 'standard' food may be compared to a 'traditionally prepared' food.
The first is prepared in a factory with control of its nutrition, the second by a home cook with limited access to nutrition modification technology.

Statements about the scheme often discuss the high salt and sugar content.
Papers discussing the effect on physiology, and pathology in particular highlight these, but they do not back their statements with analysis.
They do not show that the sodium, and UPF together increase the risk of CVD, or BP rise.
This dissertation intends to address this gap

@bykershanks2022 show an approach between individual action and changing laws.
This approach would target those most at risk due to negative social determinants.
It does move into the realm of coercion of those 'making the wrong choices' into making better choices.

### Increasing UPF

Many studies show the increasing role of UPF within the diet.
Mertens @mertens2022 and ni Mhurchu @nimhurchu2011 show how UPF are being eaten in ever greater quantities across Europe but especially across the UK.

Wang @wang2021 identifies increasing consumption in US youths, D'Avila @DavilaHelenFreitas2017Eifu also  identify that increasingly upf are the key source of energy in adolescents. Gupta @GuptaDeepanshi2021Sauf explores the role of youth, identifying the peculiar age distribution of UPF intake.

Rauber @rauber2019 look instead at free sugar intake.



### UPF and increased intake

Webster @websterSystematicSurveySodium2010 and niMurchu @nimhurchu2011 identify the amount of salt in ultraprocessed foods. Vargas @Vargas-MezaJorge2022DSaP concentrates on sodium and potassium using the Mexican national health and nutrition survey.

Sugars are the focus for Rauber @rauber2019, particularly free sugar intake.

Armendariz @armendariz2022 look at how the retail food evironment in Mexican cities has changed and how it affects BP.


### UPF and Ill Health

@mertens2022, @barbosa2022, @SantosFrancineSilvaDos2020Fpac , @aceves-martins2022, and @rauber2020 explore how UPF are associated with poor health.
Whilst this is primarily metabolic pathology they do often mention BP.
@schulze2019 comprehensively reviews UPF and metabolic health.

@OliveiraTafnes2020CtCo try to identify ill health in young people associated with the increasing use of UPF.

Hodge  @HodgeAllison2021ITIU dedicated an edition of 'Public Health Nutrition' to this question



@elliott1996



#### obesity

The link to obesity is perhaps more direct. 
Munoz  @Muñoz-LaraA2020TCOU looked at Mexican school age children. Li @LiMing2021Ufca looked at adults in China. Rauber  @rauber2020 used the NDNS study to look at obesity in the UK.

    
    

#### diabetes and cardmetabolic syndromes

Given the effects on obesity and the increase of energy intake the connection to diabetes and cardiometabolic syndromes has been the subject of more papers. 

Aguiar @AguiarSarmentoRoberta2018EPaH concentrates on diabetes only. Li @LiMing2022AbUF uses a national study to link UPF with diabetes in China. 

de Miranda Renata Costa @deMirandaRenataCosta2021Iouf identifies the effect on metabolic health. Martinez  @Martinez-PerezCelia2021Uodf connects the dietary share of UPF in the US population. Tavares @TavaresLetíciaFerreira2012Rbuf doing the same in Brazilian adolescents.

dos Santos @dossantos identifies this as cardiometabolic health and provides a systematic review @SantosFrancineSilvaDos2020Fpac . Goodman et al @GoodmanDina2020Diac explore this in Venezualan adults. Vilela @VilelaSofia2022Eotf give a '...prospective approach to childhood'.

Some authors look how these metabolic effects lead to other conditions. For example Weinstein @WeinsteinGalit2021Couf with dementia. Gomez-Smith @Gomez-SmithMariana2018RCRa identify a possible pathological explanation. Ivancovsky @IvancovskyWajcmanDana2021Ufia connects NAFLD. Lee @LeeHae-Young2022UFaa connects these to CVD.


Colombet @colombet2019 connects these changes in metabolic syndrome with changes in socioeconomic inequalities again linking the nutritional identity of diet with its social aspects.



#### cancer

@southall2022 and seperately @wangAssociationUltraprocessedFood2022 have identified a risk of colorectal cancer.

#### ckd
Kityo @KityoAnthony2022TIoU identifies the effect on the kidneys. Identifying the diverse effects of UPF and possibly also another contributory cause of BP changes.


  

### UPF BP and Salt


```{r fig-dagupfbp, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-dagupfbp
#| fig-cap: "DAG of relationships explored by analysis"

bp6 <- dagitty(" dag {
               Na -> BP
               UPF -> BP
               UPF <-> Na
               BP -> NCD}")
plot(graphLayout(bp6))

```

What is not known is how UPF cause BP.
Suter @suterNutritionalFactorsControl2002a asked Is it nutrient based?
In which case is this mediated by Salt?
Is it other factors such as the food sales environment as explored by Goncalves @GonçalvesVivianSS2019Cots ?
This study looks only at if Na is part of the causal pathway The thesis is that UPF is more of a risk than the salt it contains

Many studies use quite carefully constructed categories to achieve significant results.

The role of UPF in BP is described in a number of papers. Wang @WangMei2022UFCI delivers a meta analysis and systematic review. This identifies teh best primary research and gives an odds ratio. Scaranni  @scaranniUltraprocessedFoodsChanges2021a and  de Deus Mendonca 
  @DeDeusMendonçaRaquel2017Ufca deliver key primary studies in specific populations with Shim   @shimConsumptionUltraProcessedFood2022 providing a Korean perspective. Oliveira @OliveiraTafnes2020CtCo looks at the effect in children, Rezende @Rezende-AlvesKatiusse2021Fpar with adolescents.
  
Lima  @LimaR2011Pouf reviewed already hypertensive individuals.
  
  These papers answer to a connection between UPF and Hypertension. They leave the next obvious question to brief speculation and future research. Their offer is that UPF are high in Salt and sugars. The question is dropped, the focus elsewhere.

smiljenac  @smiljanec2020 and tzelfa @TzelefaVicky2021Aodp both look at how UPF affect the vasculature which may be part of the pathway to BP.

   
## Literature review Conclusion

The literature review identified and analysed a range of literature across the field. 
Key points being that CVD is a significant NCD, and has links with Na and UPF. 
These links are often described in different paradigms. 
This study aims to cross link these paradigms looking at how Na and UPF interact and looking to understand from a positivist approach what effects UPF have within the positivist paradigm. At the same time knowing and accepting that effects of UPF in this paradigm are a subset of the total effect. Whilst also understanding that Na in its nutritional paradigm similarly projects into the other paradigm.


\newpage

# Method 

## Study Design and Setting

National Dietary and Nutritional Survey (NDNS @universityofcambridge2022) 

This survey is a collaboration between government departments responsible for health and for food production. They have engaged academic partners to deliver reports on diet and nutrition across the United Kingdom. The study is designed to be representative across the four home nations, across age with balanced representation for children. NDNS data are available via the UK national Data service for research purposes. 

NDNS is a rolling cohort study in which each year selects a new cohort of participants. The sample is intended to be  1000 per year with 50% adults. Each year the sample is slightly different due to differential uptake. There is some oversampling to take account of this.
 
The design has a random selection across postal units (psu). This is stratified to ensure a representative sample across the four nations (England, Wales, Scotland, and Northern Ireland) and across regions within those countries (North West, North East, Scotland, Northern Ireland, Wales, Yorkshire and Humberside, East Midlands,West Midlands, London, The South East, The South West). The sample is also representative for age and sex and IMD.


## Participants, Inclusion and Exclusion 

All participants in NDNS are included.

The relationship between salt and systolic blood pressure may be different in individuals with pathologically high BP. Those taking BP controlling medications may have a different relationship to sodium and UPF. These participants were excluded from the main analysis, however this affected the sample size and skewed the male-female ratio. Thus, I have conducted a sensitivity analysis included the participants taking BP medications. 

The data from the NDNS study contains information about each individual, and their household. This was collected through questionnaires. Then weight, height, and blood pressure were measured by a nurse. Finally, dietary information was collected through a 4-day food diary. 

## Variables

The key variables are systolic BP, UPF intake and Sodium intake.

Additional variables are ones which can also influence BP. They include Age, Sex, BMI, height, and weight. Age at completion of education (educfinh), and IMD are also used. 

 

###  Systolic BP 

The mean systolic blood pressure (omsysval, BP) is a validated measurement with significant quality assessment within the dataset. 

The variable omsysval is a quality assured mean value which is reliable across the dataset.
 In particular, the omsysval variable was assessed for the effects of exercise, temperature and ill health.  Raw BP values are present in the dataset but are made up of data with issues around quality.



###  Dietary data 

The participants recorded their food intake prospectively over 4 days recording food and portion size as well as where food was eaten. Adults recorded this for the child participants. 

Based on the food and drink intake reported and with a composition data table, the NDNS team have estimated the overall intake of a large range of nutrients.  

 

###  Salt estimation 

The sodium value is one calculated from intake based on food diaries and standard food nutrient values. This only reflects standard foods and is the result of assumptions about the content being consistent. Serum sodium values are available for the early dataset, but not the later one. There are also values for 24 urinary sodium which is probably a better indicator of dietary sodium for parts of the dataset, but again these are not found in both time periods. Though they were part of a supplementary study. 

 

 
### UPF
To estimate the intake of UPF, we used  the NOVA classification, developed by Monteiro et al. (@monteiro2010). As  there is no record of NOVA classification in NDNS, I have used a table from Rauber et al (@rauber2019). The author has classified each food and drink according to the food descriptions. 

Each participant food diary entries are assessed against the Nova food classification. The weight and energy content of the day's food is calculated by Nova group. This is added to the intake for the other 3 days and the total intake by Nova group established. The percentage of the total intake of energy is then calculated for each of the 4 Nova categories. Nova group 4 or UPF intake (Epcnt_4) is used for this study. 

 

## Analysis of the data  

### Description of sample 
I amalgamated four data batches, 2008-2012, 2013-2014, 2015-2016, 2017-2019. 
The data is read from its files using ‘r-studio’ with the processing being carried out using packages (see appendix 3) available from CRAN (@base). 
Once the data labels are made consistent across the batches, weighting recalculation is done. 

This generates values which account for differences in population balance across the annual cohorts. These result from differences in compliance and uptake within and across the years. 

The years are amalgamated and the nature of the variables is specified. 
Mean values for the data are displayed with a comparison for weighted values. The exposure variables are sodium intake (Sodiummg,Na), and ultra processed food intake (Epcnt_4, UPF). The outcome variable, the mean systolic blood pressure (omsysval,BP). 

 

### Analysis of Change over Survey Years 

The second phase of analysis shows how the key variables changed over the survey years cohorts. This showed separately how the inputs and outputs have changed. 

These are not the same participants so matched analysis, or time series analysis were not directly applicable. 

Plots were given to show the values in each of the available cohorts. 

Other variables in the data were compared across to assess how the data changes. Statistical significance of changes in the data were shown by p.values with continuous data, and categorical data analysed using chi squared tables. 

### Analysis of Change by Sex Age and Place
I have analysed the key variables by sex, age in categories, and by government region. 
This intends to show the distribution of the sample across these categories.

## Univariable Regression of key variables 

Analysis of the association between BP and sodium intake, and then BP and UPF intake was done using univariable linear regression. This gave indication of the direction and strength of relationship between the variables. P.values and confidence intervals help to understand the statistical significance of these results. Comparison was also made with age,sex, region and between each of the variables. This showed the significant relationships present. 

 

## Multiple Regression on Systolic BP ,age, UPF 

Multivariable regression models were then developed to understand the interactions between variables and to develop a mathematical model of the relationship. The optimal model is one which best explains the pattern of data, but which also makes practical sense for the wider understanding of relationships.  

Several sets of four models were developed. The baseline model with the dependant variable and background variables. Then two models with each independent variable was added separately. Finally a model containing all three of the key variables.  


Assessment techniques try to understand the importance of including particular variables, and the form in which they are best included. The resultant p.values help to establish the statistical significance of the results. 

 

## AIC and sensitivty Anaylsis 

This section compares models side by side using assessment techniques to identify the best way of describing the data. The ‘best’ in part is determined by the whether a model is needed to predict more data, or just to understand the data available. Here it is about how best to describe the relationship between Na, UPF, and BP. 



```{r read-data, message=FALSE, warning=FALSE, include=FALSE, cache=TRUE}

sav4 <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_personleveldietarydata_uk_v2.sav"

sav4b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_indiv_uk.sav"

sav6 <-"/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_personleveldietarydata_v2.sav"

sav6b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_indiv.sav"

sav8 <-"/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_personleveldietarydata.sav"

sav8b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_indiv.sav"



sav11 <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr9-11a_personleveldietarydata_uk_20210831.sav"

sav11b <- "/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/UKDA-6533-spss/spss/spss25/ndns_rp_yr9-11a_indiv_20211020.sav"

sav4r <- as.data.table(read_sav(sav4))
sav4br <-as.data.table(read_sav(sav4b))

sav6r <- as.data.table(read_sav(sav6))
sav6br <-as.data.table(read_sav(sav6b))

sav8r <- as.data.table(read_sav(sav8))
sav8br <-as.data.table(read_sav(sav8b))


sav11r <- as.data.table(read_sav(sav11))
sav11br <- as.data.table(read_sav(sav11b))
sav11br$area <- sav11br$Area
```

```{r std-names4, message=FALSE, warning=FALSE, include=FALSE, cache=TRUE}
#standardise the variable names for grp 1-4 
sav4br$bpmedc2 <- sav4br$bpmedc
sav4br$bpmedd2 <- sav4br$bpmedd
sav4br$diur2 <- sav4br$diur
sav4br$beta2 <- sav4br$beta
sav4br$aceinh2 <- sav4br$aceinh
sav4br$calciumb2 <- sav4br$calciumb
sav4br$obpdrug2 <- sav4br$obpdrug

sav4br$ethgrp5 <- sav4br$ethgr5
sav4br$ethgrp2 <- sav4br$ethgr2

sav4br$hyper140_2 <- sav4br$hyper140
sav4br$hibp140_2 <- sav4br$hibp140
sav4br$hyper1_2 <- sav4br$hyper1
sav4br$highbp1_2 <- sav4br$highbp1

sav4br$educfinh <- sav4br$EducFin
sav6r$SurveyYear <- sav6r$Surveyyear
```

```{r stdnames11, message=FALSE, warning=FALSE, include=FALSE}
sav11br$htval <- sav11br$htval2
sav11br$wtval <- sav11br$wtval2
sav11br$bmival <- sav11br$bmival2

sav11br$gor <- sav11br$GOR
sav11br$age <- sav11br$AgeR
sav11r$Age <- sav11r$AgeR
sav11br[omsysval <= 10, omsysval := NA]
```

```{r novafile, message=FALSE, warning=FALSE, include=FALSE,cache=TRUE}
NOVA_ForDavid <- as.data.table(read_excel("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/upfnabp/data/NOVA_ForDavid.xlsx"))

NOVA_ForDavid[, Sex := factor(Sex, levels = 1:2)]
NOVA_ForDavid[, Country := factor(Country)]
NOVA_ForDavid[, SurveyYear := factor(SurveyYear)]
NOVA_ForDavid[, Age := as.numeric(Age)]
```

```{r weight, echo=FALSE}
#Doing the weighting correction, as explain in the PDF "6533_ndns_yrs9-11_weights_guide"

n1 = sum(sav4br$wti_UKY1234)  #Should be 6828

n2 = sum(sav6br$wti_Y56)         #Should be 2546

n3 = sum(sav8br$wti_Y78)         #Should be 2723

n4 = sum(sav11br$wti_Y911)       #Should be 3558

N <- sum(n1, n2, n3, n4) #Should be 15655
```

```{r weight2,message=FALSE, warning=FALSE, include=FALSE}
#now the proportion weight for each is calculated
sav4br$wti_UKY1to11 <- ((sav4br$wti_UKY1234/n1) * N)  * (4/11)

sav6br$wti_UKY1to11 <- ((sav6br$wti_Y56/n2) * N) * (2/11)

sav8br$wti_UKY1to11 <- ((sav8br$wti_Y78/n3) * N) * (2/11)

sav11br$wti_UKY1to11 <- ((sav11br$wti_Y911/n4) * N) * (3/11)

```

```{r allsetup-variables, message=FALSE, warning=FALSE, include=FALSE}
 #measured and recorded data yr1-4a_indiv_uk 
#subsets of the table to identify grouped information
bpset <- c("seriali","omsysval","omdiaval")
ethnset <- c("ethgrp5","ethgrp2")
saltset <- c("SaltChk","SalHowC","SltSHow" ,"vegetarn")
medsset <- c( "bpmedc2","bpmedd2","diur2","beta2","aceinh2", "calciumb2","obpdrug2", "PregNowB")
hypset <- c("hyper140_2", "hibp140_2", "hyper1_2", "highbp1_2")
incset <-c("nssec8","gor","region", "EIMD_2007_quintile","EIMD_2010_quintile","EIMD_2015_quintile","educfinh")
measset <- c("htval","wtval","bmival")
ageset <- c("agegad1", "agegad2", "agegch1","agegr1","age")
weightset <- c("wti_UKY1to11","astrata1","area")

indiv_data <- c(bpset,ethnset,saltset,medsset,hypset,incset,measset,ageset,weightset)
```

```{r individ-data,message=FALSE, warning=FALSE, include=FALSE}
sav11br <- sav11br[,..indiv_data]
sav4br <- sav4br[,..indiv_data]
sav6br <- sav6br[,..indiv_data]
sav8br <- sav8br[,..indiv_data]

val_labels(sav8br) <- NULL
val_labels(sav6br) <- NULL
val_labels(sav4br) <- NULL
val_labels(sav11br) <- NULL
#sav8br$seriali <- as.double(sav8br$seriali)
#sav8br$ethgrp5 <- as.double(sav8br$ethgrp5)
```

```{r joining-together,message=FALSE, warning=FALSE, include=FALSE}
#this creates the whole table
ndns_1_11 <- rbindlist(list(sav4br,sav6br,sav8br,sav11br),fill = TRUE, use.names = TRUE)

```

```{r define-factors,include=FALSE}
 #define factors for 1-4 
#saltset
ndns_1_11[, SaltChk := factor(SaltChk, levels = 1:8, labels = c("Salt",
	"Salt substitute",
	"Neither",
	"Item not applicable",
	"No answer/refused",
	"Don't know",
	"Qn not applicable to survey year",
	"Schedule not applicable"))]
 ndns_1_11[, SalHowC := factor(SalHowC, levels = 1:8,labels = c("Always",
"Usually",
"Sometimes",
	",Item not applicable",
	"No answer/refused",
	" Don't know",
"Qn not applicable to survey year",
"Schedule not applicable"))]
 ndns_1_11[, SltSHow := factor(SltSHow,levels = 1:8,labels = c("Always",
                                                            "Usually",
                                                            "Sometimes",
                                                            ",Item not applicable",
                                                            "No answer/refused",
                                                            " Don't know",
                                                            "Qn not applicable to survey year",
                                                            "Schedule not applicable"))]
 
 ndns_1_11[, vegetarn := factor(vegetarn, levels = 1:3, labels = c("vegetarian","vegan","not vegetarian"))]
```

```{r define-factors2 ,include=FALSE}
#medset
 ndns_1_11[, bpmedc2 := factor(bpmedc2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
 ndns_1_11[, bpmedd2 := factor(bpmedd2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, diur2 := factor(diur2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, beta2 := factor(beta2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, aceinh2 := factor(aceinh2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, calciumb2 := factor(calciumb2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
  ndns_1_11[, obpdrug2 := factor(obpdrug2,levels = 0:1,	labels = c("Not taking drug"
	,"Taking drug"))]
ndns_1_11[, PregNowB := factor(PregNowB,levels = 1:2,	labels = c("preg or breastfeeding"
	,"not preg or Bfeed"))]
 
 


 
 
 
#incset
  
 
ndns_1_11[,gor := factor(gor, levels = 1:12, labels = c("North East","North West","Yorkshire & The Humber","East Midlands","West Midlands","East of England","London","South East","South West","Wales","Scotland","Northern Ireland"))]


ndns_1_11[,region := factor(region, levels = 1:6, labels = c("England: North","England: Central/Midlands","England: South(including London)","Scotland","Wales","Northern Ireland"))] 
  
ndns_1_11[, EIMD_2007_quintile := factor(EIMD_2007_quintile, levels = 1:5)] 
ndns_1_11[,EIMD_2010_quintile := factor(EIMD_2010_quintile, levels = 1:5)] 
ndns_1_11[,EIMD_2015_quintile := factor(EIMD_2015_quintile, levels = 1:5)] 
ndns_1_11[,educfinh := factor(educfinh, levels = 1:8)] 
ndns_1_11[,nssec8 := factor(nssec8, levels = 1:8)] 
#bpset 
 
#ndns_1_11[, "omsysval" := as.numeric(omsysval)]


 #hypeset
ndns_1_11[,hyper140_2 := factor(hyper140_2,levels = 1:9, labels = c(" Normotensive untreated",
" Normotensive treated",
	"Hypertensive treated",
"Hypertensive untreated",
"No answer/refused",
	"Don't know",
"Refused, attempted but not obtained, not attempted",
	 "Qn not applicable to survey year",
"Item not applicable")) ]
 ndns_1_11[, hibp140_2 := factor(hibp140_2, levels = 1:7, labels = c("Not high BP",
"High BP",
	"No answer/refused",
	"Don't know",
	"Refused, attempted but not obtained, not attempted",
	"Qn not applicable to survey year",
	"Item not applicable")) ]
ndns_1_11[, hyper1_2 := factor(hyper1_2,levels = 1:9, labels = c(" Normotensive untreated",
                                                          " Normotensive treated",
                                                          "Hypertensive treated",
                                                          "Hypertensive untreated",
                                                          "No answer/refused",
                                                          "Don't know",
                                                          "Refused, attempted but not obtained, not attempted",
                                                          "Qn not applicable to survey year",
                                                          "Item not applicable"))]
 ndns_1_11[, highbp1_2 := factor(highbp1_2, levels = 1:7, labels = c("Not high BP",
                                                              "High BP",
                                                              "No answer/refused",
                                                              "Don't know",
                                                              "Refused, attempted but not obtained, not attempted",
                                                              "Qn not applicable to survey year",
                                                              "Item not applicable")) ]
 
 
 
 
  
#ethnset  

ndns_1_11[ , ethgrp5 := factor(ethgrp5, levels = 1:5, labels = c( 'White'
                                                             , 'Mixed ethnic group'
                                                             , 'Black or Black British'
                                                             , 'Asian or asian British'
                                                             , 'Any other group'))]
ndns_1_11[ , ethgrp2 := factor(ethgrp2, levels = 1:2, labels = c( 'White'
                                                             , 'Non-white'))]




#ageset
ndns_1_11[,agegad1 := factor(agegad1, levels = 1:4 ,labels = c("16-24","25-49","50-64","65+ years"))]
ndns_1_11[,agegad2 := factor(agegad2, levels = 1:5, labels = c("16-18","19-34","35-49","50-64","65+ years"))]
ndns_1_11[,agegch1 := factor(agegch1, levels = 1:3, labels = c("8-10","11-12","13-15"))]
ndns_1_11[,agegr1 := factor(agegr1, levels = 1:5, labels = c("1.5-3 years","4-10 years","11-18 years","19-64 years","65+ years"))]
 




 
```

```{r personal-data defn,include=FALSE}
#this identifies the variables wanted from the person level data sets
perslevdat <- c("seriali","Age","SurveyYear", "Sex","Country","Sodiummg","Calciummg","VitaminDµg","TotalEMJ", "Totalsugarsg","Glucoseg","Sucroseg","Fructoseg","Lactoseg","SOFTDRINKSLOWCALORIE","SOFTDRINKSNOTLOWCALORIE", "TEACOFFEEANDWATER")



```

```{r join-pers-level data,message=FALSE, warning=FALSE, include=FALSE}

val_labels(sav8r) <- NULL
val_labels(sav6r) <- NULL
val_labels(sav4r) <- NULL
val_labels(sav11r) <- NULL

 sav4r$Sex <- as.numeric(sav4r$Sex)
sav6rSex <- as.numeric(sav6r$Sex)

#building the tables
sav4r <- sav4r[, ..perslevdat]
sav6r <- as.data.table(sav6r[, ..perslevdat])
sav8r <- as.data.table(sav8r[, ..perslevdat])
sav11r <- sav11r[,..perslevdat]


val_labels(sav8r) <- NULL
val_labels(sav6r) <- NULL
val_labels(sav4r) <- NULL
val_labels(sav11r) <- NULL

ndns_1_11r <- rbindlist(list(sav4r,sav6r,sav8r,sav11r),fill = TRUE, use.names = TRUE)

ndns_1_11 <- ndns_1_11[ ndns_1_11r, on = "seriali"]



```

```{r tidy-up, echo=FALSE}

ndns_1_11[, Sex := factor(Sex, levels = 1:2, labels = c("Male", "Female"))]
ndns_1_11[, Country := factor(Country)]

ndns_1_11[omsysval <= 10, omsysval := NA]


upfd <- c("seriali","NOVA_Epct_opti_4","NOVA_Gpct_opti_4")
NOVA_ForDavid <- NOVA_ForDavid[,..upfd]
#NOVA_ForDavid
ndns_1_11 <- ndns_1_11[NOVA_ForDavid, on = "seriali"]
```

```{r load-food-diary-data, message=FALSE, warning=FALSE, include=FALSE,cache=TRUE}
UPFNOVA <- data.table(read_excel("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/altquant/UPFNOVA.xlsx"))
#ndns_yr1_nutrientdatabank <- data.table(read_sav("UKDA-6533-spss/spss/spss25/ndns_yr1_nutrientdatabank.sav"))

#ndns_yr11_nutrient <- data.table(read_sav("UKDA-6533-spss/spss/spss25/ndns_yr11_nutrientdatabank_2021-03-19.sav"))

 ndns1_4a_foodleveldietarydata_uk_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr1-4a_foodleveldietarydata_uk_v2.sav"))

ndns5_6a_foodleveldietarydata_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr5-6a_foodleveldietarydata_v2.sav"))
 
ndns7_8a_foodleveldietarydata_v2 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr7-8a_foodleveldietarydata.sav"))



 ndns_rp_yr9a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr9a_foodleveldietarydata_uk_20210831.sav"))
 ndns_rp_yr10a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr10a_foodleveldietarydata_uk_20210831.sav"))
 ndns_rp_yr11a_foodleveldietarydata_uk_20210831 <- data.table(read_sav("/media/david/Elements1/contents/DOHmed/MPH/MPHModules/dissertation/alternativequant/altquant/UKDA-6533-spss/spss/spss25/ndns_rp_yr11a_foodleveldietarydata_uk_20210831.sav") )
```

```{r process-food-data-into-tables, message=FALSE, warning=FALSE, include=FALSE}
#taking data from diet diary

UPFNOVA[,`Nova group`:= factor(`Nova group`,levels = 1:4)]
UPFNOVA$SubFoodGroupCode <- UPFNOVA$`food group number`

#specifically coded food groups

#combine with key for Nova Group
#first 1-4
foodlevedat4s <- ndns1_4a_foodleveldietarydata_uk_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
#foodlevedat4s[ ,seriali  := factor(seriali)]
foodlevedat4s<- foodlevedat4s[UPFNOVA, on= "SubFoodGroupCode"]
#summary(foodlevedat4s)

foodlevedat4s<- foodlevedat4s[,c("seriali","TotalGrams","Nova group","EnergykJ")]

#years 5-6
foodlevedat6s <- ndns5_6a_foodleveldietarydata_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat8s <- ndns7_8a_foodleveldietarydata_v2[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat6s<- foodlevedat6s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat8s<- foodlevedat8s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat6s<- foodlevedat6s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat8s<- foodlevedat8s[,c("seriali","TotalGrams","Nova group","EnergykJ")]


#finally years 9, 10, 11
foodlevedat9s <- ndns_rp_yr9a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat10s <- ndns_rp_yr10a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]
foodlevedat11s <- ndns_rp_yr11a_foodleveldietarydata_uk_20210831[,c("seriali","SubFoodGroupCode","RecipeSubFoodGroupCode","TotalGrams","EnergykJ")]

#combine with key for Nova Group

foodlevedat9s<- foodlevedat9s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat10s<- foodlevedat10s[UPFNOVA, on= "SubFoodGroupCode"]
foodlevedat11s<- foodlevedat11s[UPFNOVA, on= "SubFoodGroupCode"]



foodlevedat9s<- foodlevedat9s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat10s<- foodlevedat10s[,c("seriali","TotalGrams","Nova group","EnergykJ")]
foodlevedat11s<- foodlevedat11s[,c("seriali","TotalGrams","Nova group","EnergykJ")]

```

```{r individ-diet, message=FALSE, warning=FALSE, include=FALSE}
#To work out the gram weight amount of food intake by each individual, first the diary entries for each individual are totalled up.
#The total gram weight value of intake of each food is then worked out as a percentage of the total intake.



## First I write the function to process the individual entries. This totals the intake in grams and identifies the proportion by nova type.



IndividDiet <- function(DT,individ) {
  pers <- DT[seriali==individ]
pers
oneweight<-pers[, round(sum(TotalGrams),2), by=`Nova group`][order(`Nova group`)]

setnames( oneweight, 'V1','Totalg')
 oneweight[,pcnt := round((Totalg/sum(Totalg)*100),2)]

  return(na.exclude(oneweight))
}


```

```{r year-9-process, message=FALSE, warning=FALSE, include=FALSE}
#All these individual calculations are then built back up into tables.
#This is done for years 9-11 and then 1-4.

### This section uses the function designed above to process the table
name <-foodlevedat9s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat9s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat9sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat9sp



```

```{r year-10-process, warning=FALSE, include=FALSE}

name <-foodlevedat10s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat10s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat10sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat10sp


```

```{r year-11-process, message=FALSE, warning=FALSE, include=FALSE}

name <-foodlevedat11s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat11s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat11sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat11sp

#then combining the outputs 9-11
foodleveldat910sp <- rbind(foodleveldat9sp,foodleveldat10sp)
foodleveldat911sp <- rbind(foodleveldat11sp, foodleveldat910sp)
```

```{r year-5-6-process, warning=FALSE, include=FALSE}

name <-foodlevedat6s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat6s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat6sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat6sp


```

```{r year-7-8-process, warning=FALSE, include=FALSE}

name <-foodlevedat8s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat8s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat8sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat8sp


```

```{r slow-processing-four-years, echo=FALSE, warning=FALSE}

name <-foodlevedat4s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDiet(foodlevedat4s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat4sp <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('Totalg',"pcnt"))
#foodleveldat4sp



```

```{r energy-function-defn, message=FALSE, warning=FALSE, include=FALSE}
#The process can be done for food level energy intake also.

## First I write the function to process the individual entries. This totals the intake in grams and identifies the proportion by nova type.



IndividDietE <- function(DT,individ) {
  pers <- DT[seriali==individ]
pers
oneweight<-pers[, round(sum(EnergykJ),2), by=`Nova group`][order(`Nova group`)]

setnames( oneweight, 'V1','EnergykJ')
 oneweight[,Epcnt := round((EnergykJ/sum(EnergykJ)*100),2)]

  return(na.exclude(oneweight))
}


```

```{r Eyear-9-process, message=FALSE, warning=FALSE, include=FALSE}
### This section uses the function designed above to process the table
name <-foodlevedat9s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat9s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat9spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat9spE



```

```{r Eyear-10-process, message=FALSE, warning=FALSE, include=FALSE}
### This section uses the function designed above to process the table
name <-foodlevedat10s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat10s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat10spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat10spE



```

```{r Eyear-11-process, message=FALSE, warning=FALSE, include=FALSE}
### This section uses the function designed above to process the table
name <-foodlevedat11s[,.(seriali)]  
name <- as.numeric(unlist(name))
nameu <-c(unique(name))
x <- length(nameu)  
#nameu
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat11s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat11spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
foodleveldat11spE


#then combining the outputs 9-11
foodleveldat910spE <- rbind(foodleveldat9spE,foodleveldat10spE)
foodleveldat911spE <- rbind(foodleveldat11spE, foodleveldat910spE)
```

```{r Eslow-processing-four-years, echo=FALSE, warning=FALSE}

name <-foodlevedat4s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat4s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat4spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat4spE



```

```{r E8-processing-four-years, echo=FALSE, warning=FALSE}

name <-foodlevedat8s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat8s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat8spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat4spE



```

```{r E6-processing-four-years, echo=FALSE, warning=FALSE}

name <-foodlevedat6s[,.(seriali)]  
name <- (unlist(name))
nameu <-c(unique(name))
x <- length(nameu)
#summary(nameu)
outcome <- data.table()

for (i in 1:x){
  


output<- IndividDietE(foodlevedat6s,nameu[i])  

output$seriali <- nameu[i]

 outcome <-rbind(outcome,output) 
 
 
}

foodleveldat6spE <-dcast.data.table(outcome, seriali  ~ `Nova group` , value.var = c('EnergykJ',"Epcnt"))
#foodleveldat6spE



```

```{r adding-to-earlier-data2, echo=FALSE, message=FALSE, warning=FALSE}

# combine with data from version10a.rmd

#sav11rpb <- readRDS("sav11rp.rds")


setkey(foodleveldat911sp, seriali)
setkey(foodleveldat911spE, seriali)

foodleveldat911spE <-foodleveldat911spE[foodleveldat911sp, by= seriali]
#sav11rp <-sav11rp[foodleveldat911spE, by= seriali]
#sav11rp$ED <- sav11rp[,.("Epcnt_4"/"pcnt_4")]

#sav4rp <- readRDS("sav4rp.rds")

#setkey(sav4rp,seriali)
setkey(foodleveldat4sp,seriali)
setkey(foodleveldat4spE,seriali)
foodleveldat4spE<-foodleveldat4spE[foodleveldat4sp, by= seriali]
#sav4rp <-sav4rp[foodleveldat4spE, by= seriali]


#setkey(sav6rp,seriali)
setkey(foodleveldat6sp,seriali)
setkey(foodleveldat6spE,seriali)
foodleveldat6spE <-foodleveldat6spE[foodleveldat6sp, by= seriali]
#sav6rp <-sav6rp[foodleveldat6spE, by= seriali]



#setkey(sav8rp,seriali)
setkey(foodleveldat8sp,seriali)
setkey(foodleveldat8spE,seriali)
foodleveldat8spE <-foodleveldat8spE[foodleveldat8sp, by= seriali]
#sav8rp <-sav8rp[foodleveldat8spE, by= seriali]

ndns_1_11food <- rbindlist(list(foodleveldat8spE,foodleveldat4spE,foodleveldat6spE,foodleveldat911spE))
```

```{r adding-to-earlier-data, echo=FALSE, message=FALSE, warning=FALSE}
# combine with data from version10a.rmd
setkey(ndns_1_11food, seriali)
setkey(ndns_1_11, seriali)
ndns_1_11 <- ndns_1_11[ndns_1_11food, by= seriali]
```

```{r upf-tertiles, echo=FALSE,message=FALSE}
#epcnt_4 divided into tertiles as cat variable
ndns_1_11$UPF3 <-  cut(ndns_1_11$Epcnt_4 ,
                       breaks=c(0, 33, 63,100))
ndns_1_11$agegad3 <-  cut(ndns_1_11$age ,
                       breaks=c(0, 16,19,35,50,65,108))


```

```{r survey-design,message=FALSE, warning=FALSE, include=FALSE}



ndns_1_11d <- svydesign(ids = ~area, weights = ~ wti_UKY1to11, strata=~astrata1, data = ndns_1_11, nest = TRUE)



```

```{r exclusions,echo=FALSE, message=FALSE, warning=FALSE}
#Exclusions
ndns_1_11x <- subset(ndns_1_11d, TotalEMJ >= 600)

#ndns_1_11 <-ndns_1_11[(hyper1_2 == " Normotensive untreated" ), ]
ndns_1_11e <- ndns_1_11[omsysval <= 150]
ndns_1_11ed <- subset( ndns_1_11d, omsysval <= 150)
#ndns_1_11hypo <- subset(ndns_1_11, ndns_1_11$omsysval <= 150)

#there are no pregnant or breast feeding participants
#ndns_1_11n <- ndns_1_11n[(PregNowB != "preg or breastfeeding" ), ]


#medication affecting bp
#ndns_1_11e <- ndns_1_11e[diur2 == "Not taking drug"]
#ndns_1_11e <-ndns_1_11e[beta2 == "Not taking drug"]
#ndns_1_11e <-ndns_1_11e[aceinh2 == "Not taking drug"]
#ndns_1_11e <-ndns_1_11e[calciumb2 =="Not taking drug"]
#ndns_1_11e <- ndns_1_11e[obpdrug2 == "Not taking drug"]

ndns_1_11dd <- subset(ndns_1_11ed, diur2 == "Not taking drug")
ndns_1_11dd <-subset(ndns_1_11dd,beta2 == "Not taking drug")
ndns_1_11dd <-subset(ndns_1_11dd,aceinh2 == "Not taking drug")
ndns_1_11dd <-subset(ndns_1_11dd,calciumb2 =="Not taking drug")
ndns_1_11dd <- subset(ndns_1_11dd,obpdrug2 == "Not taking drug")


#ndns_1_11 <- ndns_1_11[Country == "England"]
#ndns_1_11e <- ndns_1_11e[Age >18]
#ndns_1_11ed <- subset(ndns_1_11ed,Age >18)
ndns_1_11a <- subset(ndns_1_11d, Age >18)
ndns_1_11b <- subset(ndns_1_11ed, Age >18)
ndns_1_11c <- subset(ndns_1_11dd, Age >18)
ndns_1_11ab <- subset(ndns_1_11d, Age <50)
ndns_1_11cc <- subset(ndns_1_11d, Age <50)
#ndns_1_11e <- svydesign(ids = ~area, weights = ~ wti_UKY1to11, strata=~astrata1, data = ndns_1_11e, nest = TRUE)

```

\newpage

# Results

## Participants and Descriptive Data

This first table @tbl-keydata1 includes all variables.
These are weighted values analysed using a software package called 'survey' @survey2004 .

The tables presented by NDNS have been amalgamated and new weighting values calculated which enable compilation of data from separate tables into one.
```{r tbl-keydata1, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-keydata1
#| tbl-cap: "Table of all variables used in analysis"


keydatw1 <-tbl_svysummary(ndns_1_11d, include= c(age,Sex, agegad2, omsysval, bmival, Sodiummg, Epcnt_4, UPF3, educfinh, EIMD_2010_quintile,gor ) )

as_flex_table( keydatw1)
```

Continuous variables are represented by the mean and standard deviation in brackets.
Categorical variables give the number of participants and the percentage of the sample in brackets.

#### Exposure variables
The exposure variables Sodiummg, and Epcnt_4 are continuous. The mean value for Sodiummg is 2,037. That for Epcnt_4 is 48. 
The categorical variable UPF3 shows that 67% of the population fall within the central category calculated from the standard deviation of the mean.

#### Outcome Variable
The BP is also continuous with a mean of 123 and standard deviation of 17. There are a significant number of unknowns, 7196 out of a sample of 15,655.


### Analysis of Change across cohorts

These key variables are now compared between the cohorts fist in tbl-keydata.
```{r tbl-keydata, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-keydata
#| tbl-cap: "key data"

keydatw <-tbl_svysummary(ndns_1_11d,SurveyYear , include = c(Sodiummg,Epcnt_4,omsysval),
                 statistic = list(all_continuous() ~"{mean} ({sd})"))
keydatw <-as_flex_table( keydatw)
keydatw
```
The numbers seem to be smaller towards the end of the series, for Sodium intake, UPF intake (Epcnt_4) and for systolic BP.
Each cohort has been adjusted to be comparable using weighting values given by the study coordinators.
However they are separate cohorts of separate participants with no linear association between them.
It can be seen that there are lower values for all of the variables in the later groups.


@fig-upf-and-survey-year shows the energy from UPF in percent (Epcnt_4) against cohort number.
This plot shows that the ranges largely overlap.
No visible difference is clear on this plot.

```{r fig-upf-and-survey-year, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-upf-and-survey-year
#| fig-cap: "Plot of the percentage of energy from UPF in each annual cohort showing an apparent overlap"


svyplot(Epcnt_4~SurveyYear,ndns_1_11d, na.rm = TRUE,main = "Energy from UPF in percent by survey year", ylab = "Energy percent from UPF" ,xlab ="Survey Year")
```

```{r fig-Na-and-survey-year, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-Na-and-survey-year
#| fig-cap: "Plot of the intake of Na in mg in each annual cohort showing an apparent overlap "
svyplot(Sodiummg~SurveyYear,ndns_1_11d,main = "Sodium Intake in mg by survey year", ylab = "Sodium intake in mg" ,xlab ="Survey Year")

```

```{r fig-BP-and-survey-year, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-BP-and-survey-year
#| fig-cap: "Plot of the BP in mmHg in each annual cohort showing an apparent overlap"

svyplot(omsysval~SurveyYear,ndns_1_11d, na.rm = TRUE,main = "Systolic BP in mmHg by survey year", ylab = "Sysltolic BP in mmHg" ,xlab ="Survey Year")
```

The sodium intake @fig-Na-and-survey-year, and the Systolic BP @fig-BP-and-survey-year do not show an obvious change across the cohorts.

```{r tbl-Key-Variables-by-Survey-year, echo=FALSE}
#| label: tbl-Key-Variables-by-Survey-year
#| tbl-cap: "Key Variables (Na, UPF, BP) by Survey cohort showing a negative gradient in relation to year one which is statistically significant"

ttestNa2 <- svyglm(Sodiummg~SurveyYear, ndns_1_11d )
ttestNa2t <- tbl_regression(ttestNa2)
ttestEpcnt <- svyglm(Epcnt_4~SurveyYear, ndns_1_11d )
ttestEpcntt <- tbl_regression(ttestEpcnt)
ttestOS <- svyglm(omsysval~SurveyYear, ndns_1_11d)
ttestOSt <- tbl_regression(ttestOS)

as_flex_table(tbl_stack(list(ttestNa2t,ttestEpcntt,ttestOSt),group_header =  c("Sodium in mg", "Percent Energy UPF","Systolic BP")))
```

@tbl-Key-Variables-by-SurveyYear compares mean sodium, UPF and systolic BP values across the individual cohorts.
This uses cohort 1 as a comparator for the other cohorts.
The differences and the beta variable do not depend on there being a linear or ordinal arrangement between the cohorts.

This shows that for sodium there is a beta of `r ttestNa2t$table_body$estimate` with confidence limits of `r ttestNa2t$table_body$ci`; For UPF beta is `r ttestEpcntt$table_body$estimate` and confidence limits `r ttestEpcntt$table_body$ci`; and for BP `r ttestOSt$table_body$estimate` and `r ttestOSt$table_body$ci`.
Each beta value is negative which means that these values in each cohort is largely below that of the first reference year.
The confidence intervals do not pass unity and so these results are statistically significant.

These corresponding negative beta values do not mean that there is a correlation between these variables.
This will be examined later.

### Other variables compared across cohorts

This section shows how variables are distributed between the survey annual cohorts.
The NDNS dataset was weighted to keep many of these, but not all,  the same between datasets.
Continuous variables are assessed using linear regression and categorical variables using chi squared tests to give p.values.


This table @tbl-continuous-data) suggests that there is a significant difference in the bmi of the cohorts.

```{r tbl-continuous-data, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-continuous-data
#| tbl-cap: "Table of Age and BMI regressed against survey year identifying that there is no significant change in Age, but that there is a significant difference in BMI"
ttestage <- svyglm(Age ~ SurveyYear, ndns_1_11d)
ttestages<-  tbl_regression(ttestage)


ttestbmi <- svyglm(bmival~SurveyYear, ndns_1_11d)
ttestbmis <- tbl_regression(ttestbmi)

tablecon <- as_flex_table(tbl_stack(list(ttestages,ttestbmis),group_header =  c("Age","BMI")))
tablecon
```

There is a difference in the age of finishing education.

The differences in qimd, are not statistically significant.

These values identify a significant difference in the number of vegetarians

```{r tbl-Categorical-variables-year, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-Categorical-variables-year
#| tbl-cap: "Categorical Variables analysed using Chi squared approach to give p values indicating Sex and IMD as not statistically significantly different from year one, and Education and Vegetarian as statistically significant"

sexchi <- svychisq(~Sex +SurveyYear , ndns_1_11d)
educhi <- svychisq(~educfinh+SurveyYear , ndns_1_11d)
imdchi <- svychisq(~EIMD_2010_quintile+SurveyYear , ndns_1_11d)
vegchi <- svychisq(~vegetarn+ SurveyYear , ndns_1_11d)
UPF3chi <- svychisq(~UPF3+ SurveyYear , ndns_1_11d)


tablecat<- data.table("Variable"=c( "Sex", "Education","IMD","Vegetarian","UPF3"),"ChiSq"=c(sexchi$statistic,educhi$statistic,imdchi$statistic,vegchi$statistic,UPF3chi$statistic ),"p.value"= c(sexchi$p.value,educhi$p.value,imdchi$p.value,vegchi$p.value,UPF3chi$p.value ))
tablecat <- flextable(tablecat)
tablecat <- colformat_double(tablecat, digits = 4)

tablecat <- footnote( tablecat, i = 1, j = 2,
            value = as_paragraph(c("Chi Squared for categorical data")),
            ref_symbols = c("1"),
            part = "header")
tablecat <- valign(tablecat, valign = "bottom", part = "header")
autofit(tablecat)
```

### Analysis of Key variables by Sex
```{r tbl-keydatax, echo=FALSE, message=FALSE, warning=FALSE}

#| label: tbl-keydatax
#| tbl-cap: "Table of key variables by sex showing less exposure to UPF and Sodium in females and a lower BP"

keydatwx <-tbl_svysummary(ndns_1_11d,Sex, include = c(Sodiummg,Epcnt_4,UPF3,omsysval))
keydatwx <-as_flex_table( keydatwx)
keydatwx


```
@tbl-keydatax shows the difference between male and female in the key variables. 

These box plots (@fig-BP-Sex-Boxplots, @fig-Na-Sex-Boxplots, @fig-UPF-Sex-Boxplots) show the difference between the sexes in the key variables.

```{r fig-Na-Sex-Boxplots, echo=FALSE, fig.id=TRUE ,message=FALSE, warning=FALSE}
#|label: fig-Na-Sex-Boxplots
#|fig-cap: "The difference in Sodium intake in mg between male and female showing a slightly lower value in the female cohort"
svyboxplot(Sodiummg~Sex,ndns_1_11d, na.rm = TRUE,main = "Sodium Intake in mg by Sex", ylab = "Sodium intake in mg" ,xlab ="Sex")
```

```{r fig-UPF-Sex-Boxplots, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-UPF-Sex-Boxplots
#|fig-cap: "The difference in UPF intake by % between male and female showing a slightly lower value in the female cohort"
svyboxplot(Epcnt_4~Sex,ndns_1_11d, na.rm = TRUE,main = "% Energy Intake UPF by sex", ylab = "% Energy Intake UPF" ,xlab ="Sex")

```


```{r  fig-BP-Sex-Boxplots, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-BP-Sex-Boxplots
#| fig-cap: "The difference in Systolic BP in mmHg between male and female showing a slightly lower value in the female cohort"

svyboxplot(omsysval~Sex,ndns_1_11d, na.rm = TRUE,main = "Systolic BP in mmHg by Sex", ylab = "Sysltolic BP in mmHg" ,xlab ="Sex")
```

In each graph there is little difference apparent, though perhaps the female plot is slightly lower.

```{r tbl-Key-Variables-by-Sex, echo=FALSE}
#| label: tbl-Key-Variables-by-Sex
#| tbl-cap: "Variables-by Sex in the full population showing the statistical significance against Male category as a comparator"

ttestNax <- svyglm(Sodiummg~Sex, ndns_1_11d )
ttestNaxt<- tbl_regression(ttestNax)
ttestEpcnx <- svyglm(Epcnt_4~Sex, ndns_1_11d )
ttestEpcnxt <- tbl_regression(ttestEpcnx)
ttestOSx <- svyglm(omsysval~Sex, ndns_1_11d )
ttestOSxt <- tbl_regression(ttestOSx)

as_flex_table(tbl_stack(list(ttestNaxt,ttestEpcnxt,ttestOSxt),group_header =  c("Sodium in mg", "Percent Energy UPF","Systolic BP")))
```

@tbl-Key-Variables-by-Sex shows that for all these variables there is a lower beta coefficient for females. In each case the lower gradient of the relationship between the variable and Sex is statistically significant as the confidence intervals do not cross one. 




### Analysis of Key Variables by Age
```{r tbl-keydataA, echo=FALSE, message=FALSE, warning=FALSE}

#| label: tbl-keydataA
#| tbl-cap: "key data"

keydatwA <-tbl_svysummary(ndns_1_11d,agegad3, include = c(Sodiummg,Epcnt_4,UPF3,omsysval))
keydatwA <-as_flex_table( keydatwA)
keydatwA


```
@tbl-tbl-keydataA shows the age distribution of exposure to sodium and UPF. Peak sodium exposure in the 19-35 age group. The peak UPF exposure is in the 16-18 age group, but is almost matched by the 0-16 group. The outcome BP rises through life.


```{r  fig-BP-age-Boxplots, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-BP-age-Boxplots
#| fig-cap: "The difference in Systolic BP in mmHg between Age groups showing a sttrong overlap"

svyboxplot(omsysval~ agegad2 ,ndns_1_11d, na.rm = TRUE,main = "Systolic BP in mmHg by Age", ylab = "Sysltolic BP in mmHg" ,xlab ="Age")
```

```{r fig-Na-age-Boxplots, echo=FALSE,message=FALSE, warning=FALSE}
#| label: fig-Na-age-Boxplots
#| fig-cap: "The difference in Sodium intake in mg between Age groups showing a sttrong overlap" 
svyboxplot(Sodiummg~agegad2,ndns_1_11d, na.rm = TRUE,main = "Sodium Intake in mg by Age", ylab = "Sodium intake in mg" ,xlab ="Age")
```

```{r fig-UPF-age-Boxplots, echo=FALSE,message=FALSE, warning=FALSE}
#| label: fig-UPF-age-Boxplots
#| fig-cap: "The difference in UPF intake in % between Age groups showing a sttrong overlap" 
svyboxplot(Epcnt_4~agegad2,ndns_1_11d, na.rm = TRUE,main = "UPF intake in % by Age", ylab = "UPF intake in %" ,xlab ="Age")
```

```{r tbl-Key-Variables-by-age, echo=FALSE}
#| label: tbl-Key-Variables-by-age
#| tbl-cap: "Variables by age in the full population showing the statistical significance against Age categories as comparators"

ttestNaA <- svyglm(Sodiummg~agegad2, ndns_1_11d )
ttestNaAt<- tbl_regression(ttestNaA)
ttestEpcnA <- svyglm(Epcnt_4~agegad2, ndns_1_11d )
ttestEpcnAt <- tbl_regression(ttestEpcnA)
ttestOSA <- svyglm(omsysval~agegad2, ndns_1_11d )
ttestOSAt <- tbl_regression(ttestOSA)

as_flex_table(tbl_stack(list(ttestNaAt,ttestEpcnAt,ttestOSAt),group_header =  c("Sodium in mg", "Percent Energy UPF","Systolic BP")))
```

@tbl-Key-Variables-by-age is interesting in that it shows that whilst the BP goes up across the age categories, the UPF intake decreases.
The changes in sodium content are particularly interesting as they show that the older age groups have much lower sodium intake, but the highest sodium intake in in the second group, with the first and third being statistically no different.

### Analysis of Key Variables by Place

```{r tbl-keydatap, echo=FALSE, message=FALSE, warning=FALSE}

#| label: tbl-keydatap
#| tbl-cap: "Table of key variables by age place showing differing exposure and outcome by place"

keydatwp <-tbl_svysummary(ndns_1_11d,gor, include = c(Sodiummg,Epcnt_4,UPF3,omsysval))
keydatwp <-as_flex_table( keydatwp)
keydatwp


```
@tbl-datap shows the UPF exposure is highest in Northern Ireland and lowest in London.
The sodium exposure is highest in Scotland and lowest in London.
Outcome BP is also lowest in London, with the highest in the North East.


```{r tbl-Key-Variables-by-place, echo=FALSE}
#| label: tbl-Key-Variables-by-place
#| tbl-cap: "Variables by place in the full population showing the statistical significance against Age categories as comparators"

ttestNag <- svyglm(Sodiummg~relevel(gor, ref = "North West"), ndns_1_11d )
ttestNagt<- tbl_regression(ttestNag)
ttestEpcng <- svyglm(Epcnt_4~relevel(gor, ref = "North West"), ndns_1_11d )
ttestEpcngt <- tbl_regression(ttestEpcng)
ttestOSg <- svyglm(omsysval~relevel(gor, ref = "North West"), ndns_1_11d )
ttestOSgt <- tbl_regression(ttestOSg)

as_flex_table(tbl_stack(list(ttestNagt,ttestEpcngt,ttestOSgt),group_header =  c("Sodium in mg", "Percent Energy UPF","Systolic BP")))
```
@tbl-Key-Variables-by-place shows that in comparison to the North West only London has a statistically significant negative gradient in salt intake. The UPF intake is higher in Northern Ireland and the West Midlands, and lower in London. The BP is lower in London only.





## Paired Regression of key variables on each other

```{r fig-dag2, echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-dag2
#| fig-cap: "Diagram of relationships explored by analysis"
bp1 <- dagitty(" dag {
               Na -> BP
               Age -> BP
               Sex -> BP
               UPF -> BP
               UPF -> Na
               Age -> UPF
               Sex -> UPF
               BP -> NCD
               Age -> Na
}")
plot(graphLayout(bp1))

```
@fig-dag2 shows the range of relationships explored by the paired regressions.


Simple linear regression equations look for the relationship between the BP, and the independent variable.

First @fig-Na-by-BP

```{r fig-Na-by-BP,echo=FALSE}
#| label: fig-Na-by-BP
#| tbl-cap: "Plot of Sodium Intake agaist BP showing lack of direction to the relationship"
svyplot(omsysval~Sodiummg, ndns_1_11c ,main = "Sodium Intake in mg", xlab = "Sodium Intake mg" ,ylab ="Systolic BP")
```

Then @fig-BP-and-UPF

```{r fig-BP-and-UPF,echo=FALSE, message=FALSE, warning=FALSE}
#| label: fig-BP-and-UPF
#| tbl-cap: "Plot of UPF Intake agaist BP showing lack of direction to the relationship"
svyplot(omsysval~Epcnt_4, ndns_1_11c,main = "% Energy Intake UPF by Systolic BP", xlab = "% Energy Intake UPF" ,ylab ="Systolic BP")

```

and lastly @fig-UPF-and-Na-plot

```{r fig-UPF-and-Na-plot,echo=FALSE,  message=FALSE, warning=FALSE}
#| label: fig-UPF-and-Na-plot
#| tbl-cap: "Plot of Sodium agaist UPF  intake showing lack of direction to the relationship"
svyplot(Epcnt_4~Sodiummg, ndns_1_11c,main = "% Energy Intake UPF by Sodiummg", ylab = "% Energy Intake UPF" ,xlab ="Sodium in mg")

```
Simple plots of exposure against outcome appear to show limited correlation.



```{r tbl-univariable-regressions, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-univariable-regressions
#| tbl-cap: "regressions in pairs between key variables full population showing direction and strength of relationships"
#univariable regression models
#UPF Energy % only
lm1E <- svyglm(omsysval ~ Epcnt_4, ndns_1_11d)
lm1Et <- tbl_regression(lm1E)
#univariable regression models
#sodium only
lm1na <- svyglm(omsysval ~ Sodiummg, ndns_1_11d)
lm1nat <- tbl_regression(lm1na)

lmEna <- svyglm(Epcnt_4 ~ Sodiummg, ndns_1_11d)
lmEnat <- tbl_regression(lmEna)

lmA <- svyglm(omsysval ~ Age, ndns_1_11d)
lmAt <- tbl_regression(lmA)

lmEA <- svyglm( Age ~ Epcnt_4, ndns_1_11d)
lmEAt <- tbl_regression(lmEA)

lmNaA <- svyglm(Sodiummg ~ Age, ndns_1_11d)
lmNaAt <- tbl_regression(lmNaA)

#row1<- tbl_merge(list(lm1nat,lm1Et,lmEnat),tab_spanner = c("BP","UPF","Na"))
#row2 <- tbl_merge(list(lmAt,lmEAt,lmNaAt),tab_spanner = c("BP","UPF","Na"))
as_flex_table(tbl_stack(list(lm1nat,lmEnat,lm1Et,lmEAt,lmAt,lmNaAt),group_header = c("BP/Na","UPF/Na","UPF/bp","UPF/Age","Age/BP","Age/Na")))
```

The regression model for Sodium against BP shows that there is no linear relationship between Sodium and BP in this table @tbl-univariable-regressions. UPF compared to Na also shows a zero beta value indicating no linear relationship.

UPF does show a negative relationship with age, which is statistically significant. There is also a negative relationship with Age, again statistically significant. 

Age has a relationship with BP with a statistically significant positive gradient. There is also a positive relationship with Na, which is also statistically significant to the 95% level.



```{r tbl-more-univariable-regressions, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-more-univariable-regressions
#| tbl-cap: "pair regressions of BP, Na and UPF againt Age, bmi, educfinh full population"
#univariable regression models
#UPF Energy % only
lm1bmi <- svyglm(omsysval ~ bmival, ndns_1_11d)
lm1bmit <- tbl_regression(lm1bmi)
#univariable regression models
#sodium only
lm1Ag1 <- svyglm(omsysval ~ agegad1, ndns_1_11d)
lm1Ag1t <- tbl_regression(lm1Ag1)

lmEbmi <- svyglm(Epcnt_4 ~ bmival, ndns_1_11d)
lmEbmit <- tbl_regression(lmEbmi)

lmed <- svyglm(omsysval ~ educfinh, ndns_1_11d)
lmedt <- tbl_regression(lmed)

lmEs <- svyglm(Epcnt_4 ~ agegad1, ndns_1_11d)
lmEst <- tbl_regression(lmEs)

lmEed <- svyglm(Epcnt_4 ~ educfinh, ndns_1_11d)
lmEedt <- tbl_regression(lmEed)

lmNabm <- svyglm(Sodiummg ~ bmival, ndns_1_11d)
lmNabmt <- tbl_regression(lmNabm)

lmNaed <- svyglm(Sodiummg ~ educfinh, ndns_1_11d)
lmNaedt <- tbl_regression(lmNaed)

lmNaAg <- svyglm(Sodiummg ~ agegad1, ndns_1_11d)
lmNaAgt <- tbl_regression(lmNaAg)

#row1<- tbl_merge(list(lm1nat,lm1Et,lmEnat),tab_spanner = c("BP","UPF","Na"))
#row2 <- tbl_merge(list(lmAt,lmEAt,lmNaAt),tab_spanner = c("BP","UPF","Na"))
as_flex_table(tbl_stack(list(lm1bmit,lm1Ag1t,lmedt,lmEbmit,lmEst,lmEedt,lmNabmt,lmNaAgt,lmNaedt),group_header = c("BP/bmi","BP/Agg1","BP/ed","UPF/bmi","UPF/age","UPF/ed","Na/bmi","Na/Agg","Na/ed")))
```



In conclusion the linear regression models show that there are correlations between the systolic BP and energy intake only.
The next section will examine how this situation changes as variables interact in more complex models.




## Complex Modelling using Multi variable regression

This section uses models of several variables to try to highlight the contributions of each variable. The complexity in these models is much less than that of reality. 
There are four sets of four models. The first a baseline model, the second and third introduce each variable separately, the final model includes all three.

The intention is to work towards an optimal model. This ideally mathematically describes the situation. In reality there may be a set of models with no single one predominating.

In particular the research question asks about the relationship between Sodium and UPF intake with BP.
The models will reflect this question by looking to include or exclude particular variables.
Comparisons between these models are then made using sensitivity analysis, identifying how sensitive the model is to sodium, or other factors

###  Regression on BP

```{r bp-multivariable-models, echo=FALSE, warning=FALSE}

lm1AS <- svyglm(omsysval ~  Sex +bmival +agegad3+educfinh + EIMD_2010_quintile , ndns_1_11d, na.action = na.exclude)

theme_gtsummary_mean_sd()

#sodium only
lmna <- svyglm( omsysval ~ Sodiummg  +Sex +agegad3 + bmival+educfinh+  EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmnaE <- svyglm(omsysval ~ Sodiummg +Sex +agegad3+Epcnt_4 + bmival +educfinh+ EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmME <- svyglm( omsysval~ Epcnt_4 +agegad3+Sex + bmival +educfinh + EIMD_2010_quintile , ndns_1_11d,na.action =na.exclude)

```

```{r tbl-multivariable-outputs-bp, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-multivariable-outputs-bp
#| tbl-cap: "Table of multivariable regression against BP in 4 models to identify the effects realting to Na and UPF"
lm1ASt <-tbl_regression(lm1AS)
lmnat <- tbl_regression(lmna)
lmnaEt <- tbl_regression(lmnaE)
lmMEt <- tbl_regression(lmME)

 as_flex_table(  tbl_merge(list(lm1ASt,lmnat,lmMEt,lmnaEt), tab_spanner = c("No sodium or UPF","Sodium only","UPF only","Sodium and UPF")))
```

This first set of models are in @tbl-multivariable-outputs-bp and look at what happens when regression against BP is used.

The first model, labelled "No sodium or UPF" of this set looks at the relationships between BP and some of the background variables (Age and Sex, education and IMD) all of which may have an effect on BP.
This model excludes UPF and Na.

The second model, "Sodium Only", shows that sodium has a zero beta coefficient, but that this is not statistically significant. It also shows minimal effects on the other variables in the model.

The model, "UPF only", is in the third set of columns. Here there is a negative beta coefficient, but the confidence intervals cross one. This indicates that the effect is statistically uncertain. Again there are minimal effects on the other variables.

The last set of columns, "Sodium and UPF", shows that when combined there is still little effect identified statistically, on each other or on the other variables.

Using the AIC statistic for each model gives another way of understanding the comparative effects.
The subsequent @tbl-AIC-comparison-bp shows the size of the effect relating to sodium. The lowest scored model is the optimal model. Here that is "UPF only". Though the size of the difference is tiny.

```{r tbl-AIC-comparison-bp, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-AIC-comparison-bp
#| tbl-cap: "AIC-comparison BP"

AICt<- data.table("Model"=c("No sodium or UPF","Sodium only","Epcnt only","Sodium and UPF"),"AIC" =c(lm1AS$aic, lmna$aic,lmME$aic,lmnaE$aic))
flextable(AICt)
```



###  simple set Regression on BP
```{r regression-on-BPs, echo=FALSE, message=FALSE, warning=FALSE}





#sodium only
#lmnaj <- svyglm( omsysval ~ Sodiummg + agegad3 , ndns_1_11d,na.action = na.exclude)

lmnaEj <- svyglm(omsysval ~ Sodiummg +Epcnt_4 , ndns_1_11d,na.action = na.exclude)

#lmMEj <- svyglm( omsysval~ Epcnt_4 +agegad3 , ndns_1_11d,na.action =na.exclude)
#lmnaja  <-      anova(lmnaj)
#lmnaja
```

```{r tbl-multivariable-output-BPs, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-multivariable-output-BPs
#| tbl-cap: "multivariable-outputs BP"

lm1nat <- tbl_regression(lm1na)
lmnaEjt <- tbl_regression(lmnaEj)
lm1Et <- tbl_regression(lm1E)

 as_flex_table(  tbl_merge(list(lm1nat,lm1Et,lmnaEjt), tab_spanner = c("Sodium only","UPF only","Sodium and UPF")))
```

```{r tbl-AIC-comparison-AS, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-AIC-comparison-AS
#| tbl-cap: "AIC-comparison AS"

AICjt<- data.table("Model"=c("Sodium only","UPF only","Sodium and UPF"),"AIC" =c( lm1na$aic,lm1E$aic,lmnaEj$aic))
flextable(AICjt)

```

This second set of regressions @tbl-multivariable-output-BPs follows the pattern but omits the baseline as those variables are all excluded. It is an exploration of a 'simpler' model. That is one with less variables included.

The AIC values @tbl-AIC-comparison-AS are all significantly higher, which may indicate that these models are actually less close to an accurate description of the source data. That is actually less simple to bring towards the data.

The 'best ' of these models is that with all values included. The UPF models both being further away from the lowest value.


###  Regression on Na

```{r na-lmME, echo=FALSE, warning=FALSE}

lm1AS2 <- svyglm(Sodiummg ~  Sex +bmival +agegad3+educfinh + EIMD_2010_quintile , ndns_1_11d, na.action = na.exclude)

theme_gtsummary_mean_sd()

#sodium only
lmna2 <- svyglm( Sodiummg ~  omsysval +Sex +agegad3 + bmival+educfinh+  EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmnaE2 <- svyglm(Sodiummg ~ omsysval +Sex +agegad3+Epcnt_4 + bmival +educfinh+ EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmME2 <- svyglm( Sodiummg ~  Epcnt_4 +agegad3+Sex + bmival +educfinh + EIMD_2010_quintile , ndns_1_11d,na.action =na.exclude)

```

```{r tbl-na-multivariable-outputs, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-na-multivariable-outputs
#| tbl-cap: "multivariable-outputs Na"
lm1AS2t <-tbl_regression(lm1AS2)
lmna2t <- tbl_regression(lmna2)
lmnaE2t <- tbl_regression(lmnaE2)
lmME2t <- tbl_regression(lmME2)

 as_flex_table(  tbl_merge(list(lm1AS2t,lmna2t,lmME2t,lmnaE2t), tab_spanner = c("No bp or UPF","BP only","UPF only","BP and UPF")))
```

```{r tbl-AIC-comparison-Na, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-AIC-comparison-Na
#| tbl-cap: "AIC-comparison Na"

AIC2t<- data.table("Model"=c("No bp or UPF","bp only","UPF only","bp and UPF"),"AIC" =c(lm1AS2$aic, lmna2$aic,lmME2$aic,lmnaE2$aic))
flextable(AIC2t)
```

This set of models @tbl-na-multivariable-outputs follows the  established pattern. Baseline, add variable one to baseline, add add variable two to baseline, and both variables. 

This time variable one is BP, and variable two is UPF.

The baseline regression shows some changes from the previous baseline. The sex coefficent is still statistically significant. The bmi coefficient is not. The age pattern and that with education and IMD is similar. 

Introducing BP doesn't change the structure of the beta values, or the statistical significance, but the AIC value changes @tbl-AIC-comparison-Na significantly. There is clearly a strong effect of BP on the nature of the regressions. This is shown again when BP and UPF are included.

UPF now has a clear positive effect on the Na intake. When BP is included, despite its effect not being statistically significant, the model drops its AIC value again.



### Regression on UPF
```{r regression-on-upf, echo=FALSE, warning=FALSE}

lm1AS3 <- svyglm(Epcnt_4 ~  Sex +bmival +agegad3+educfinh + EIMD_2010_quintile , ndns_1_11d, na.action = na.exclude)

theme_gtsummary_mean_sd()

#sodium only
lmna3 <- svyglm( Epcnt_4 ~  omsysval +Sex +agegad3 + bmival+educfinh+  EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmnaE3 <- svyglm(Epcnt_4 ~ omsysval +Sex +agegad3+Sodiummg + bmival +educfinh+ EIMD_2010_quintile , ndns_1_11d,na.action = na.exclude)

lmME3 <- svyglm( Epcnt_4 ~  Sodiummg +agegad3+Sex + bmival +educfinh + EIMD_2010_quintile , ndns_1_11d,na.action =na.exclude)

```

```{r upf-multivariable-outputs, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-upf-multivariable-outputs
#| tbl-cap: "multivariable-outputs upf"
lm1AS3t <-tbl_regression(lm1AS3)
lmna3t <- tbl_regression(lmna3)
lmnaE3t <- tbl_regression(lmnaE3)
lmME3t <- tbl_regression(lmME3)

 as_flex_table(  tbl_merge(list(lm1AS3t,lmna3t,lmME3t,lmnaE3t), tab_spanner = c("No bp or UPF","BP only","Epcnt only","BP and UPF")))
```

```{r AIC-comparison4, echo=FALSE, message=FALSE, warning=FALSE}
#| label: tbl-AIC-comparison-upf
#| tbl-cap: "AIC-comparison upf"

AIC3t<- data.table("Model"=c("No bp or Na","bp only","Na only","bp and Na"),"AIC" =c(lm1AS3$aic, lmna3$aic,lmME3$aic,lmnaE3$aic))
flextable(AIC3t)
```

This fourth set of models @tbl-upf-multivariable-outputs regresses on UPF intake. Variable one is BP, and variable two is sodium (Na).

Again the baseline differs from that regressed on BP with the bmi in particular affected. There is also a stronger effect relating to age. All age categories are statistically different to the reference, previously only the older ones have been.

BP and Na are not statistically significant independently or together in themselves. However together they affect reduce the sex difference to loose statistical significance.

On its own introducing BP affects the effect of bmi. 

The AIC values @tbl-AIC-comparison-upf  in models with BP are the lowest of all the models presented.
This identifies the regression against UPF including Na and BP as the best model. 
This also identifies the model regressed against Na without BP or UPF as the least good model for the dataset.  

```{r AIC-sense1, echo=FALSE, message=FALSE, warning=FALSE}

#AIC(lmM,lmMna,lmM2)
sense1 <- (lm1AS2$aic - lmnaE3$aic)*100/lm1AS2$aic 
#sense1


```
The difference between the two values as a proportion of the larger is `r sense1 ` %. There is a significant sensitivity of the data set to improved modelling. Though the set of models around the same values includes the four regressed against BP, and two of those against UPF which include BP.


## Summary of Results

@tbl-keydata with means for the key variables across the dataset showing a reduction across the cohorts. This is less evident in the plots, but the @tbl-Key-Variables-by-Survey-year shows statistical analysis of the key variables shows the reduction.

@tbl-continuous-data and @tbl-Categorical-variables-year show the other variables analysed and show that there has been change in the balance of the populations.

Analysis by Sex shows that female sex always reduces BP. When analysed by age, UPF reduces, BP increases, as does Na though with a more complex relationship. Analysis by place shows that most areas are similar, but with London as an outlier.


Paired regression, @tbl-univariable-regressions, shows that sodium intake has no relationship with BP or UPF with Na.
It shows that UPF intake decreases with age, and UPF decreases with BP.
It also shows that the change of BP with age and with Na are positive

The sets of models of multivariable regressions show that the model regressed on UPF including Na and BP has the lowest AIC. The highest AIC statistic is for the model regressed against Na without BP or UPF.



\newpage

# Discussion

## Introduction to Discussion

This section will consider what the results mean section by section.
That will include how the context of the literature influences understanding of the values.
The limitations of the study will be considered.
Opportunities for further research, and ways to influence policy will be considered.

## Data

NDNS data is well collected and comprehensive.
There have been several changes over the course of the study.
These changes have meant that collating the data was more than just bringing all the numbers together.

In addition the differing take up rates between different groups in each of the cohorts meant that the numbers from each cohort are not comparable.
This is overcome by using weighting factors to balance the datasets.
This needs adjusting every time there is a new group added to the collected data set.

## Discussion of change across cohorts

The analysis using these weighted datasets is performed using "survey" which is a software package used in r studio.

The change in intake of sodium and UPF over time could be; 1 real 2 sample error 3 increasing social desirability of low sodium, low UPF

### of other variables compared across cohorts

Age seems to be related to UPF having a similar effect on BP.
This would mean that the relationship of different aged participants and their UPF habit is affecting the comparisons within the multivariable models.

## Discussion of key variables by Sex

The populations do change over time as some of the added variables do show statistical significant changes.
In particular the number of vegetarians increases, which perhaps is one indicator of social desirability affecting the study.

In populations with exclusions the careful sample selection and weighting are overcome by the biasing effect of different selections.
When this is on BP there is a change between cohort sex balance.
This is possibly as a result of changing/ increasing acceptance of BP results of all people whereas in earlier cohorts there were less women with raised BP levels.

This effect is perhaps greater when medication exclusions are made.
Treatment of women and younger men has increased over the 10 years of the study.

## Discussion of key variables by Age

Comparison of pairs of variables identifies the degree of correlation between them.
The key comparisons are between UPF and BP, and Na and BP.
These highlight that there is an effect of UPF on BP, though there is no effect of Na.

The third side of this triangle is the relationship between Na and UPF which confirms that UPF is high in Sodium.

## Discussion of key variables by Place

The results here show that there is regional variation in key variables with consistently better values in London. 


## DiscussionPaired Regression of key variables on each other


## Complex Modelling using Multi variable regression

### analysis for BP

The multivariable regression is made of four models.
These show the change from excluding Na and UPf to adding each individually and then together.
They are all statistically significant when Age is excluded.

This means that the all have effects on the systolic blood pressure, but the effect of UPF and that of Age is closely intertwined.

### simple set BP


### analysis for Sodium

### analysis for UPF


## Limitations of Study

### The study

### The data

### The analysis

## Ideas for further research

I will divide these suggestions into quantitative and qualitative.
Within the quantitative there are biomedical

### Quantitative

There is scope for more research based on this data set.
Within this same biomedical paradigm there are whole range of variables which can be compared against the clinical and biochemical outcomes.

### Mixed and Qualitative

The richness of the quantitative data in this survey calls for its use within an approach allowing more detailed description and in depth assessment with participants.

It could also be used as a template for studies smaller in geographical scope, but more in depth as cross over studies collecting both quantitative and qualitative data.

Modelling research has allowed projections to be made using

## Ideas for policy

Policy is an 'upstream' approach.

Ideas include legislation to reduce UPF use, this might be by pricing, or other approaches.

Health promotion policy needs to match policy activity.
People who know that UPF is bad, are more likely to accept policy limiting availability.

\newpage

# Conclusion

In conclusion there is a complex interaction between fixed factors and societal factors at work.
Nova encompasses more than nutrition alone and whilst UPF has harmful elements these are not simply nutritional factors, but are complex social factors.
These factors are omitted and ignored by a rigid nutritional approach to what is primarily a social function.

\newpage

# Bibliography

::: {#refs}
:::

# Appendix {.unnumbered}

# Appendix 1 Approved Proposal

The approved proposal

# Appendix 2 Ethics Certificate

The ethics cert.

# Appendix 3 Software used

The software used
``` {r package-cite, echo=FALSE, warnings=FALSE }
cite_packages(output="citekeys", out.dir = getwd() ,out.format= "Rmd")

```

